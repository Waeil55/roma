<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Merola - Fun Learning</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap');
        
        :root {
            --bg-color: #f0f4ff;
            --card-bg: #ffffff;
            --text-color: #2d3436;
            --title-color: #4834d4; 
            --instr-color: #636e72;
            --border-color: #e0e6ed;
            --primary-action: #6c5ce7;
            --user-font-size: 22px;
            --accent-pink: #ff9ff3;
            --accent-yellow: #feca57;
            --accent-green: #1dd1a1;
        }

        .dark {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-color: #f1f5f9;
            --title-color: #a29bfe; 
            --instr-color: #94a3b8;
            --border-color: #334155;
            --primary-action: #818cf8;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#d1d8ff 0.5px, transparent 0.5px);
            background-size: 20px 20px;
            color: var(--text-color);
            transition: all 0.3s ease;
            overscroll-behavior-y: contain;
        }

        .glass-header {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border-bottom: 3px solid var(--border-color);
            border-radius: 0 0 2rem 2rem;
        }
        .dark .glass-header {
            background: rgba(30, 41, 59, 0.85);
        }

        .card {
            background-color: var(--card-bg);
            border: 3px solid var(--border-color);
            box-shadow: 0 8px 0px var(--border-color);
            border-radius: 2.5rem;
            transition: transform 0.2s ease;
        }

        .q-text {
            font-size: var(--user-font-size) !important;
            color: var(--text-color) !important;
            line-height: 1.5;
            font-weight: 800;
        }

        .option-btn {
            font-size: calc(var(--user-font-size) * 0.9) !important;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 3px solid var(--border-color);
            background-color: var(--card-bg);
            border-radius: 1.5rem;
            color: var(--text-color) !important;
            box-shadow: 0 4px 0px var(--border-color);
        }

        .option-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 7px 0px var(--border-color);
            border-color: var(--primary-action);
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 2px 0px var(--border-color);
        }

        .passage-box {
            background: linear-gradient(145deg, #ffffff, #f0f4ff) !important;
            color: #2d3436 !important; 
            border: 3px solid #6c5ce7;
            padding: 1.5rem;
            border-radius: 2rem;
            box-shadow: 0 10px 20px rgba(108, 92, 231, 0.1);
        }

        .dark .passage-box {
            background: linear-gradient(145deg, #1e293b, #334155) !important;
            color: #f1f5f9 !important;
        }

        .correct {
            background-color: #1dd1a1 !important;
            border-color: #10ac84 !important;
            color: #ffffff !important;
            box-shadow: 0 4px 0px #10ac84 !important;
        }

        .wrong {
            background-color: #ff6b6b !important;
            border-color: #ee5253 !important;
            color: #ffffff !important;
            box-shadow: 0 4px 0px #ee5253 !important;
        }

        .hub-card {
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            border: 4px solid rgba(255,255,255,0.3);
        }
        .hub-card:hover { 
            transform: scale(1.05) rotate(1deg);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .lesson-gradient { background: linear-gradient(135deg, #6c5ce7, #a29bfe); }
        .coin-gradient { background: linear-gradient(135deg, #00b894, #55efc4); }
        .time-gradient { background: linear-gradient(135deg, #fd79a8, #fab1a0); }
        .math-gradient { background: linear-gradient(135deg, #e17055, #ff7675); }
        .shapes-gradient { background: linear-gradient(135deg, #0984e3, #74b9ff); }
        .grammar-gradient { background: linear-gradient(135deg, #636e72, #b2bec3); }

        #progress-bar {
            background: linear-gradient(90deg, #6c5ce7, #ff9ff3);
            border-radius: 1rem;
        }

        .floating {
            animation: floating 3s ease-in-out infinite;
        }

        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .coin-img {
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.2));
            transition: transform 0.2s;
        }
        .coin-img:hover { transform: scale(1.1) rotate(5deg); }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="glass-header sticky top-0 z-50 px-4 py-4 flex flex-col gap-1 shadow-xl">
        <div class="app-shell flex justify-between items-center w-full max-w-6xl mx-auto">
            <div class="flex items-center gap-3">
                <div class="bg-yellow-400 p-2 rounded-2xl shadow-inner floating">
                    <span class="text-2xl">üåü</span>
                </div>
                <h1 class="text-xl sm:text-2xl md:text-3xl font-black tracking-tight" style="color: var(--title-color);">Merola Study App</h1>
            </div>
            <div class="flex items-center gap-2 sm:gap-4">
                <div class="flex items-center bg-white dark:bg-slate-700 rounded-2xl p-1 shadow-inner border-2 border-slate-200">
                    <button onclick="adjustFont(-2)" class="w-8 h-8 flex items-center justify-center font-black text-slate-900 dark:text-white hover:bg-slate-100 rounded-xl">-</button>
                    <span class="px-2 text-[10px] font-black opacity-50">Aa</span>
                    <button onclick="adjustFont(2)" class="w-8 h-8 flex items-center justify-center font-black text-slate-900 dark:text-white hover:bg-slate-100 rounded-xl">+</button>
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="toggleTheme()" class="w-11 h-11 flex items-center justify-center rounded-2xl bg-white dark:bg-slate-800 border-2 border-slate-200 shadow-sm text-xl">
                        <span id="theme-icon">‚ú®</span>
                    </button>
                    <button onclick="goHome()" class="w-11 h-11 flex items-center justify-center rounded-2xl bg-white dark:bg-slate-800 border-2 border-slate-200 shadow-sm text-xl">
                        <span>üè†</span>
                    </button>
                </div>
            </div>
        </div>
        <div id="progress-container" class="hidden app-shell w-full max-w-4xl mx-auto mt-4 flex flex-col gap-1">
            <div class="flex justify-between items-end px-2">
                <span id="page-indicator" class="text-xs font-black uppercase tracking-widest text-indigo-500">Page 1</span>
                <span class="text-[10px] font-bold opacity-50">Keep going! üöÄ</span>
            </div>
            <div class="h-4 bg-slate-200 dark:bg-slate-700 rounded-full p-1 shadow-inner">
                <div id="progress-bar" class="h-full transition-all duration-700" style="width: 0%"></div>
            </div>
        </div>
    </header>

    <main class="flex-grow w-full max-w-6xl mx-auto px-4 py-8 mb-28">
        <div id="main-view"></div>
    </main>

    <footer id="quiz-footer" class="hidden fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] max-w-2xl bg-white/90 dark:bg-slate-900/90 backdrop-blur-md border-4 border-indigo-100 dark:border-slate-700 p-3 z-40 shadow-2xl rounded-[2.5rem]">
        <div class="flex gap-4">
            <button onclick="handleBack()" id="prev-btn" class="flex-1 py-4 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 rounded-[1.8rem] font-black text-lg hover:bg-slate-200 transition-all border-b-4 border-slate-300">Back</button>
            <button onclick="nextPage()" id="next-btn" class="flex-[2] py-4 bg-indigo-600 text-white rounded-[1.8rem] font-black text-lg shadow-lg hover:bg-indigo-700 transition-all border-b-4 border-indigo-800">Next Step ‚ú®</button>
        </div>
    </footer>

    <div id="toast" class="fixed top-32 left-1/2 -translate-x-1/2 px-8 py-4 rounded-[2rem] text-white font-black shadow-2xl transition-all duration-500 opacity-0 scale-50 pointer-events-none z-[60] flex items-center gap-3"></div>

    <script>
        // All original data and logic remains untouched as requested
        const COIN_URLS = {
            c1: "https://raw.githubusercontent.com/Waeil55/roma/main/1.PNG",
            c5: "https://raw.githubusercontent.com/Waeil55/roma/main/5.PNG",
            c10: "https://raw.githubusercontent.com/Waeil55/roma/main/10.PNG",
            c25: "https://raw.githubusercontent.com/Waeil55/roma/main/25.PNG",
            c100: "https://raw.githubusercontent.com/Waeil55/roma/main/1dollar.PNG"
        };

        const getCoin = (key) => {
            const sizes = {
                c10: '4.2em', c1: '4.45em', c5: '5.0em', c25: '5.7em', c100: '6.25em'
            };
            return `<img src="${COIN_URLS[key]}" class="coin-img inline-block align-middle mx-1" style="height: ${sizes[key]}" alt="${key}">`;
        };

        function getClockSVG(h, m) {
            const hDeg = (h % 12 + m / 60) * 30;
            const mDeg = m * 6;
            return `
            <svg class="clock-svg w-32 h-32 mx-auto my-4" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="46" fill="#f8faff" stroke="#6c5ce7" stroke-width="4"/>
                <circle cx="50" cy="50" r="40" fill="white"/>
                ${[12, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11].map((n, i) => {
                    const ang = (i * 30) * Math.PI / 180;
                    return `<text x="${50 + 33 * Math.sin(ang)}" y="${53 - 33 * Math.cos(ang)}" font-size="9" text-anchor="middle" fill="#2d3436" font-weight="900">${n}</text>`;
                }).join('')}
                <line x1="50" y1="50" x2="50" y2="28" stroke="#2d3436" stroke-width="4" stroke-linecap="round" transform="rotate(${hDeg} 50 50)"/>
                <line x1="50" y1="50" x2="50" y2="18" stroke="#6c5ce7" stroke-width="3" stroke-linecap="round" transform="rotate(${mDeg} 50 50)"/>
                <circle cx="50" cy="50" r="3" fill="#2d3436"/>
            </svg>`;
        }

        function getShapeSVG(type) {
            const shapes = {
                circle: '<circle cx="50" cy="50" r="40" fill="#ff7675" stroke="#d63031" stroke-width="3"/>',
                square: '<rect x="15" y="15" width="70" height="70" fill="#74b9ff" stroke="#0984e3" stroke-width="3"/>',
                triangle: '<polygon points="50,10 90,85 10,85" fill="#55efc4" stroke="#00b894" stroke-width="3"/>',
                rectangle: '<rect x="10" y="25" width="80" height="50" fill="#ffeaa7" stroke="#fdcb6e" stroke-width="3"/>',
                star: '<polygon points="50,5 63,35 95,35 70,55 80,85 50,65 20,85 30,55 5,35 37,35" fill="#fd79a8" stroke="#e84393" stroke-width="3"/>',
                sphere: '<circle cx="50" cy="50" r="40" fill="url(#sphereGrad)"/><defs><radialGradient id="sphereGrad" cx="30%" cy="30%" r="50%"><stop offset="0%" stop-color="#a29bfe"/><stop offset="100%" stop-color="#6c5ce7"/></radialGradient></defs>',
                cube: '<path d="M20 30 l30 -10 l30 10 v40 l-30 10 l-30 -10 z" fill="#fab1a0" stroke="#e17055" stroke-width="3"/><path d="M20 30 l30 10 l30 -10 M50 40 v40" fill="none" stroke="#e17055" stroke-width="3"/>',
                cone: '<ellipse cx="50" cy="80" rx="30" ry="10" fill="#fdcb6e" stroke="#d17a22" stroke-width="3"/><path d="M20 80 L50 20 L80 80" fill="#fdcb6e" stroke="#d17a22" stroke-width="3"/>',
                cylinder: '<ellipse cx="50" cy="25" rx="30" ry="10" fill="#81ecec" stroke="#00cec9" stroke-width="3"/><path d="M20 25 v50 a30 10 0 0 0 60 0 v-50" fill="#81ecec" stroke="#00cec9" stroke-width="3"/><ellipse cx="50" cy="75" rx="30" ry="10" fill="none" stroke="#00cec9" stroke-width="3" stroke-dasharray="3 3"/>',
                pyramid: '<polygon points="50,15 85,85 15,85" fill="#a29bfe" stroke="#6c5ce7" stroke-width="3"/><line x1="50" y1="15" x2="50" y2="85" stroke="#6c5ce7" stroke-width="2"/>'
            };
            return `<svg class="w-32 h-32 mx-auto my-4" viewBox="0 0 100 100">${shapes[type] || ''}</svg>`;
        }

        // Full lessonData as provided in original
        const lessonData = [
            {
                title: "Page 1: Antonyms",
                instr: "Choose the word that means the opposite of the underlined word.",
                qs: [
                    { q: "1. a <u>problem</u>", opts: ["solution", "worry", "math", "sentence"], c: 0 },
                    { q: "2. was <u>loose</u>", opts: ["tight", "large", "big", "win"], c: 0 },
                    { q: "3. a <u>question</u>", opts: ["word", "poem", "answer", "talk"], c: 2 },
                    { q: "4. was <u>fact</u>", opts: ["true", "real", "scary", "fiction"], c: 3 },
                    { q: "5. was <u>straight</u>", opts: ["bent", "tall", "narrow", "long"], c: 0 },
                    { q: "6. to <u>create</u>", opts: ["make", "build", "destroy", "draw"], c: 2 },
                    { q: "7. was <u>shiny</u>", opts: ["dull", "bright", "pretty", "ugly"], c: 0 },
                    { q: "8. to <u>listen</u>", opts: ["hear", "ignore", "touch", "eat"], c: 1 }
                ]
            },
            {
                title: "Page 2: Homographs",
                instr: "Choose the word that correctly completes BOTH sentences.",
                qs: [
                    { q: "1. She counted all the ___ in her purse.<br>He will ___ clothes before practice.", opts: ["coins", "change", "buy", "money"], c: 1 },
                    { q: "2. I will ___ a movie before bed.<br>Use your ___ to tell the time.", opts: ["watch", "clock", "see", "rent"], c: 0 },
                    { q: "3. If it gets too hot, turn on the ___.<br>I am a big ___ of the basketball team.", opts: ["fan", "air", "player", "water"], c: 0 },
                    { q: "4. Don't forget to ___ your bag.<br>Buy a ___ of gum at the store.", opts: ["stick", "pack", "bring", "use"], c: 1 },
                    { q: "5. She ___ school every day at 3:00.<br>In the fall, rake the ___.", opts: ["grass", "leaves", "visits", "flowers"], c: 1 },
                    { q: "6. We took a ___ to the fair.<br>You can ___ your dog to do tricks.", opts: ["car", "teach", "train", "bus"], c: 2 },
                    { q: "7. Learn about ___ in science class.<br>Floss the ___ between your teeth.", opts: ["plants", "letter", "water", "space"], c: 3 },
                    { q: "8. Don't ___ in front of others.<br>___ the paper into four squares.", opts: ["tear", "rip", "cut", "hit"], c: 2 }
                ]
            },
            {
                title: "Page 3: Prefixes Mastery",
                instr: "Choose the correct word based on the prefix meaning.",
                qs: [
                    { q: "1. Which word means <b>not</b> fair?", opts: ["Fairness", "Unfair", "Missfair", "Disfair"], c: 1 },
                    { q: "2. Which word means to wind <b>again</b>?", opts: ["Rewind", "Rewinding", "Unwind", "Miswind"], c: 0 },
                    { q: "3. Which word means to heat <b>before</b>?", opts: ["Heating", "Preheat", "Unheat", "Misheat"], c: 1 },
                    { q: "4. Which word means to make <b>again</b>?", opts: ["Remake", "Remaking", "Unmake", "Dismake"], c: 0 },
                    { q: "5. Which word means to <b>stop appearing</b>?", opts: ["Appearing", "Disappear", "Misappear", "Reappear"], c: 1 },
                    { q: "6. Which word means to spell <b>wrong</b>?", opts: ["Spellings", "Misspell", "Unspell", "Prespell"], c: 1 },
                    { q: "7. Which word means to <b>not</b> agree?", opts: ["Agreements", "Disagree", "Unagree", "Misagree"], c: 1 },
                    { q: "8. Which word means <b>not</b> even?", opts: ["Evenly", "Uneven", "Reeven", "Diseven"], c: 1 }
                ]
            },
            {
                title: "Page 4: Suffixes Mastery",
                instr: "Choose the correct word based on the suffix meaning.",
                qs: [
                    { q: "1. Which word means <b>without</b> worth?", opts: ["Worthful", "Worthless", "Worthness", "Worthly"], c: 1 },
                    { q: "2. Which word means the <b>state</b> of being weak?", opts: ["Weakly", "Weakness", "Weakful", "Weakless"], c: 1 },
                    { q: "3. Which word means <b>full of</b> help?", opts: ["Helpless", "Helpful", "Helpness", "Helply"], c: 1 },
                    { q: "4. Which word means <b>one who</b> teaches?", opts: ["Teaching", "Teacher", "Teachless", "Teachful"], c: 1 },
                    { q: "5. Which word means <b>without</b> a home?", opts: ["Homely", "Homeless", "Homeness", "Homeful"], c: 1 },
                    { q: "6. Which word means <b>full of</b> color?", opts: ["Colorly", "Colorful", "Colorless", "Colorness"], c: 1 },
                    { q: "7. Which word means <b>in a quick way</b>?", opts: ["Quickless", "Quickly", "Quickful", "Quicker"], c: 1 },
                    { q: "8. Which word means <b>one who</b> leads?", opts: ["Leading", "Leader", "Leadless", "Leadful"], c: 1 }
                ]
            },
            {
                title: "Page 5: Phonics Auditory",
                instr: "Identify words with specific beginning or ending sounds.",
                qs: [
                    { q: "1. Same <b>beginning sound</b> as <u>duck</u>:", opts: ["drop", "door", "jump"], c: 1 },
                    { q: "2. Same <b>beginning sound</b> as <u>shoe</u>:", opts: ["slip", "shop", "school"], c: 1 },
                    { q: "3. Same <b>ending sound</b> as <u>bed</u>:", opts: ["ready", "door", "lead"], c: 2 },
                    { q: "4. Same <b>ending sound</b> as <u>back</u>:", opts: ["check", "lunch", "camp"], c: 0 }
                ]
            },
            {
                title: "Page 6: Phonics & Mixed Practice",
                instr: "Choose the best word based on sounds or context.",
                qs: [
                    { q: "5. Same middle sound as <b>chart</b>:", opts: ["past", "brain", "tray", "farm"], c: 3 },
                    { q: "6. Same middle sound as <b>feet</b>:", opts: ["met", "them", "treat", "there"], c: 2 },
                    { q: "7. Synonym of <u>fast</u>:", opts: ["slow", "race", "quick", "run"], c: 2 },
                    { q: "8. Antonym of <u>outside</u>:", opts: ["under", "playing", "next", "inside"], c: 3 },
                    { q: "9. Please ___ papers / never been to that ___.", opts: ["put", "place", "school", "lay"], c: 1 },
                    { q: "10. turn ___ / answers ___ on test.", opts: ["left", "correct", "right", "around"], c: 2 }
                ]
            },
            {
                title: "Pages 7-8: Section 2 - Penguins",
                passage: "Most penguins live in a land of snow and ice. They have feathers, wings, and a beak... But they cannot fly because their body is too heavy. They use their flat, stiff wings as flippers to help them swim swiftly. They eat shrimplike animals called krill.",
                qs: [
                    { q: "1. Which sentence DOES NOT tell how they move?", opts: ["waddle land", "slide on bellies", "make nest of pebbles", "webbed feet"], c: 2 },
                    { q: "2. Meaning of <b>swiftly</b>:", opts: ["carefully", "quickly", "slowly", "safely"], c: 1 },
                    { q: "3. <b>Krill</b> means:", opts: ["eggs", "fish", "shrimplike animals", "babies"], c: 2 },
                    { q: "4. Fact about penguins:", opts: ["bad swimmers", "exactly like other birds", "wings help swim", "only mothers"], c: 2 }
                ]
            },
            {
                title: "Pages 9-10: Wright Brothers",
                passage: "Orville and Wilbur Wright owned a bicycle shop. In 1899, they began to experiment with flight using kites and gliders. In 1903, they took the first motor-powered flight for 12 seconds.",
                qs: [
                    { q: "8. Main idea:", opts: ["Testing bad", "Flyer first", "Early pilots", "Bike shop"], c: 2 },
                    { q: "9. <b>Experiment</b>:", opts: ["try new ideas", "test kites", "stay in air", "fly airplane"], c: 0 },
                    { q: "12. Opposite of started:", opts: ["began", "finished", "first", "continued"], c: 1 },
                    { q: "13. Opinion:", opts: ["Tested kites", "Flight in 1903", "Very smart", "Flyer first"], c: 2 }
                ]
            },
            {
                title: "Pages 11-12: Section 3 - My Shadow",
                passage: "I have a little shadow that goes in and out with me. He is very like me from the heels up to the head... The funniest thing about him is the way he likes to grow.",
                qs: [
                    { q: "1. Poem focus:", opts: ["school", "animals", "shadow relationship", "lost"], c: 2 },
                    { q: "2. Feeling:", opts: ["afraid", "bored", "amused", "quiet"], c: 2 },
                    { q: "3. Difference:", opts: ["grow/shrink", "jump", "find dew", "play"], c: 0 }
                ]
            },
            {
                title: "Pages 13-14: Uncle Wilber",
                passage: "Uncle Wilber is strange. He sent Oscar the goldfish. Friday Wilber came to take Oscar home. He left a heavy box that hisses and says 'Be Careful'.",
                qs: [
                    { q: "8. What happened Friday?", opts: ["got fish", "got letter", "picked up Oscar", "vacation"], c: 2 },
                    { q: "10. Describe Wilber:", opts: ["weird", "rude", "greedy", "selfish"], c: 0 }
                ]
            },
            {
                title: "Page 16: Synonyms Mastery",
                instr: "Choose the word that means about the same.",
                qs: [
                    { q: "1. was <u>old</u>", opts: ["new", "ancient", "young", "dirty"], c: 1 },
                    { q: "2. was <u>quiet</u>", opts: ["loud", "silent", "noisy", "yelling"], c: 1 },
                    { q: "3. was <u>thin</u>", opts: ["narrow", "wide", "short", "tall"], c: 0 },
                    { q: "4. was <u>unusual</u>", opts: ["regular", "normal", "strange", "same"], c: 2 },
                    { q: "5. was <u>shiny</u>", opts: ["bright", "dull", "new", "pretty"], c: 0 }
                ]
            },
            {
                title: "Page 17: Context Clues Mastery",
                instr: "Read the context and fill in the numbered blanks.",
                passage: "My family is going on a (1) trip. We will (2) to the beach in our car. Some people like to (3) soda and eat candy. You should (4) brush your teeth. We are going to learn (6) animals. I do not have (7) time to finish my book.",
                qs: [
                    { q: "1. Blank (1):", opts: ["large", "clean", "special", "hard"], c: 2 },
                    { q: "2. Blank (2):", opts: ["swim", "travel", "together", "bring"], c: 1 },
                    { q: "3. Blank (3):", opts: ["drink", "carry", "start", "bring"], c: 0 }
                ]
            }
        ];

        const initialCoinData = [
            { q: `${getCoin('c1')} + ${getCoin('c1')} + ${getCoin('c1')}`, opts: ["2 cents", "3 cents", "5 cents", "10 cents"], c: 1 },
            { q: `${getCoin('c5')} + ${getCoin('c5')}`, opts: ["5 cents", "10 cents", "25 cents", "2 cents"], c: 1 },
            { q: `${getCoin('c10')} + ${getCoin('c10')}`, opts: ["10 cents", "20 cents", "25 cents", "15 cents"], c: 1 },
            { q: `${getCoin('c25')} + ${getCoin('c10')}`, opts: ["30 cents", "35 cents", "40 cents", "25 cents"], c: 1 },
            { q: `${getCoin('c100')} - ${getCoin('c25')}`, opts: ["75 cents", "50 cents", "25 cents", "100 cents"], c: 0 },
            { q: `${getCoin('c25')} + ${getCoin('c25')} + ${getCoin('c25')} + ${getCoin('c25')}`, opts: ["50 cents", "75 cents", "$1.00", "$2.00"], c: 2 },
            { q: `${getCoin('c10')} + ${getCoin('c5')} + ${getCoin('c1')}`, opts: ["15 cents", "16 cents", "20 cents", "11 cents"], c: 1 },
            { q: `${getCoin('c100')} + ${getCoin('c100')} + ${getCoin('c25')}`, opts: ["$1.25", "$2.25", "$3.00", "$2.50"], c: 1 },
            { q: `${getCoin('c100')} + ${getCoin('c100')} + ${getCoin('c100')}`, opts: ["$1.00", "$2.00", "$3.00", "$4.00"], c: 2 },
            { q: `${getCoin('c100')} + ${getCoin('c10')} + ${getCoin('c10')} + ${getCoin('c5')}`, opts: ["$1.20", "$1.25", "$1.30", "$1.15"], c: 1 },
            { q: `${getCoin('c100')} + ${getCoin('c100')} + ${getCoin('c5')} + ${getCoin('c1')}`, opts: ["$2.05", "$2.10", "$2.06", "$2.15"], c: 2 },
            { q: `${getCoin('c100')} - ${getCoin('c10')} - ${getCoin('c10')}`, opts: ["90 cents", "80 cents", "70 cents", "100 cents"], c: 1 },
            { q: `${getCoin('c100')} + ${getCoin('c100')} + ${getCoin('c25')} + ${getCoin('c10')} + ${getCoin('c5')}`, opts: ["$2.40", "$2.50", "$2.35", "$2.45"], c: 0 },
            { q: `${getCoin('c100')} + ${getCoin('c100')} + ${getCoin('c100')} + ${getCoin('c100')}`, opts: ["$3.00", "$4.00", "$5.00", "$2.00"], c: 1 },
            { q: `${getCoin('c25')} + ${getCoin('c25')} + ${getCoin('c25')}`, opts: ["50 cents", "75 cents", "$1.00", "25 cents"], c: 1 },
            { q: `${getCoin('c10')} + ${getCoin('c10')} + ${getCoin('c10')} + ${getCoin('c10')}`, opts: ["30 cents", "40 cents", "50 cents", "20 cents"], c: 1 },
            { q: `${getCoin('c100')} + ${getCoin('c25')} + ${getCoin('c1')}`, opts: ["$1.25", "$1.26", "$1.30", "$1.01"], c: 1 }
        ];

        function generateTimeData() {
            const times = [];
            for (let i = 0; i < 100; i++) {
                const h = Math.floor(Math.random() * 12) + 1;
                const m = Math.floor(Math.random() * 12) * 5;
                const correctStr = `${h}:${m.toString().padStart(2, '0')}`;
                const opts = new Set([correctStr]);
                while (opts.size < 4) {
                    const dh = Math.floor(Math.random() * 12) + 1;
                    const dm = Math.floor(Math.random() * 12) * 5;
                    opts.add(`${dh}:${dm.toString().padStart(2, '0')}`);
                }
                const sortedOpts = Array.from(opts).sort();
                times.push({ q: `What time is it now?<br>${getClockSVG(h, m)}`, opts: sortedOpts, c: sortedOpts.indexOf(correctStr) });
            }
            return times;
        }

        function generateMathData() {
            const math = [];
            for (let i = 0; i < 150; i++) {
                const op = Math.random() > 0.5 ? '+' : '-';
                let a, b, res;
                if (op === '+') { a = Math.floor(Math.random() * 101); b = Math.floor(Math.random() * (101 - a)); res = a + b; }
                else { a = Math.floor(Math.random() * 101); b = Math.floor(Math.random() * (a + 1)); res = a - b; }
                const correct = res.toString();
                const opts = new Set([correct]);
                while (opts.size < 4) opts.add((res + Math.floor(Math.random() * 20) - 10).toString());
                const sortedOpts = Array.from(opts).sort((x, y) => parseInt(x) - parseInt(y));
                math.push({ q: `Calculate: ${a} ${op} ${b} = ?`, opts: sortedOpts, c: sortedOpts.indexOf(correct) });
            }
            return math;
        }

        function generateShapesData() {
            const list = [];
            const names = ["circle", "square", "triangle", "rectangle", "star", "sphere", "cube", "cone", "cylinder", "pyramid"];
            for (let i = 0; i < 120; i++) {
                const type = names[Math.floor(Math.random() * names.length)];
                const correct = type.charAt(0).toUpperCase() + type.slice(1);
                list.push({
                    q: `What shape is this?<br>${getShapeSVG(type)}`,
                    opts: ["Circle", "Square", "Triangle", "Rectangle", "Star", "Sphere", "Cube", "Cone", "Cylinder", "Pyramid"].sort(),
                    c: ["Circle", "Square", "Triangle", "Rectangle", "Star", "Sphere", "Cube", "Cone", "Cylinder", "Pyramid"].sort().indexOf(correct)
                });
            }
            return list;
        }

        function generateGrammarData() {
            const nouns = ["Dog", "Apple", "Teacher", "School", "Book", "Park", "Cat", "Ball", "Table", "Chair", "Car", "Tree"];
            const verbs = ["Run", "Jump", "Eat", "Sleep", "Sing", "Dance", "Write", "Read", "Swim", "Play", "Laugh", "Walk"];
            const list = [];
            for (let i = 0; i < 120; i++) {
                const isNoun = Math.random() > 0.5;
                const word = isNoun ? nouns[Math.floor(Math.random() * nouns.length)] : verbs[Math.floor(Math.random() * verbs.length)];
                list.push({
                    q: `Is the word "<b>${word}</b>" a Noun or a Verb?`,
                    opts: ["Noun", "Verb"],
                    c: isNoun ? 0 : 1
                });
            }
            return list;
        }

        let currentView = 'home'; 
        let activeData = [];
        let currentPage = 0;
        let userAnswers = {};
        let fontSize = 22;
        let isDarkMode = false;

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark', isDarkMode);
            document.getElementById('theme-icon').innerText = isDarkMode ? '‚òÄÔ∏è' : '‚ú®';
        }

        function goHome() {
            currentView = 'home';
            render();
            window.scrollTo(0, 0);
        }

        function adjustFont(val) {
            fontSize = Math.max(18, Math.min(50, fontSize + val));
            document.documentElement.style.setProperty('--user-font-size', `${fontSize}px`);
        }

        function startSection(type) {
            let baseData = [];
            let perPage = 5;
            if (type === 'lesson') { activeData = lessonData; }
            else if (type === 'coin') { baseData = shuffle([...initialCoinData]); perPage = 2; }
            else if (type === 'time') { baseData = shuffle(generateTimeData()); perPage = 8; }
            else if (type === 'math') { baseData = shuffle(generateMathData()); perPage = 10; }
            else if (type === 'shapes') { baseData = shuffle(generateShapesData()); perPage = 5; }
            else if (type === 'grammar') { baseData = shuffle(generateGrammarData()); perPage = 10; }

            if (type !== 'lesson') {
                activeData = [];
                for (let i = 0; i < baseData.length; i += perPage) {
                    activeData.push({ 
                        title: `${type.charAt(0).toUpperCase() + type.slice(1)} Explorer`, 
                        instr: "Solve the puzzles below!", 
                        qs: baseData.slice(i, i + perPage) 
                    });
                }
            }
            currentPage = 0;
            userAnswers = {};
            currentView = 'quiz';
            render();
            window.scrollTo(0, 0);
        }

        function handleBack() {
            if (currentPage > 0) { 
                currentPage--; 
                render(); 
                window.scrollTo(0, 0);
            }
            else goHome();
        }

        function nextPage() {
            if (currentPage < activeData.length - 1) { 
                currentPage++; 
                render(); 
                window.scrollTo(0, 0);
            }
            else finish();
        }

        function render() {
            const main = document.getElementById('main-view');
            const footer = document.getElementById('quiz-footer');
            const progress = document.getElementById('progress-container');

            if (currentView === 'home') {
                footer.classList.add('hidden');
                progress.classList.add('hidden');
                main.innerHTML = `
                    <div class="text-center py-4">
                        <div class="mb-12">
                            <h2 class="text-5xl lg:text-7xl font-black mb-4 text-indigo-600 dark:text-indigo-400">Study Hub</h2>
                            <p class="text-xl lg:text-2xl font-bold text-slate-500">What do you want to learn today?</p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                            <div onclick="startSection('lesson')" class="hub-card lesson-gradient p-10 rounded-[3rem] text-white flex flex-col items-center justify-center gap-4 shadow-xl">
                                <div class="text-7xl">üìö</div>
                                <div class="text-center"><h3 class="text-3xl font-black mb-1">Lessons</h3><p class="opacity-90 font-bold text-sm">Full Review</p></div>
                            </div>
                            <div onclick="startSection('coin')" class="hub-card coin-gradient p-10 rounded-[3rem] text-white flex flex-col items-center justify-center gap-4 shadow-xl">
                                <div class="text-7xl">ü™ô</div>
                                <div class="text-center"><h3 class="text-3xl font-black mb-1">Money</h3><p class="opacity-90 font-bold text-sm">Counting Coins</p></div>
                            </div>
                            <div onclick="startSection('time')" class="hub-card time-gradient p-10 rounded-[3rem] text-white flex flex-col items-center justify-center gap-4 shadow-xl">
                                <div class="text-7xl">‚è∞</div>
                                <div class="text-center"><h3 class="text-3xl font-black mb-1">Clock</h3><p class="opacity-90 font-bold text-sm">Telling Time</p></div>
                            </div>
                            <div onclick="startSection('math')" class="hub-card math-gradient p-10 rounded-[3rem] text-white flex flex-col items-center justify-center gap-4 shadow-xl">
                                <div class="text-7xl">‚ûï</div>
                                <div class="text-center"><h3 class="text-3xl font-black mb-1">Math</h3><p class="opacity-90 font-bold text-sm">Fun Calculations</p></div>
                            </div>
                            <div onclick="startSection('shapes')" class="hub-card shapes-gradient p-10 rounded-[3rem] text-white flex flex-col items-center justify-center gap-4 shadow-xl">
                                <div class="text-7xl">üî∑</div>
                                <div class="text-center"><h3 class="text-3xl font-black mb-1">Shapes</h3><p class="opacity-90 font-bold text-sm">Geometry</p></div>
                            </div>
                            <div onclick="startSection('grammar')" class="hub-card grammar-gradient p-10 rounded-[3rem] text-white flex flex-col items-center justify-center gap-4 shadow-xl">
                                <div class="text-7xl">‚úçÔ∏è</div>
                                <div class="text-center"><h3 class="text-3xl font-black mb-1">Words</h3><p class="opacity-90 font-bold text-sm">Noun vs Verb</p></div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentView === 'quiz') {
                footer.classList.remove('hidden');
                progress.classList.remove('hidden');
                const data = activeData[currentPage];
                document.getElementById('page-indicator').innerText = `Page ${currentPage + 1} of ${activeData.length}`;
                document.getElementById('progress-bar').style.width = `${((currentPage + 1) / activeData.length) * 100}%`;

                let passageHtml = '';
                if (data.passage) {
                    passageHtml = `
                        <div class="mb-10">
                            <div class="passage-box shadow-lg">
                                <p class="font-bold leading-relaxed text-xl">${data.passage}</p>
                            </div>
                        </div>`;
                }

                let questionsHtml = '';
                data.qs.forEach((q, qIdx) => {
                    const key = `${currentPage}-${qIdx}`;
                    const answered = userAnswers[key] !== undefined;
                    questionsHtml += `
                        <div class="card p-8 mb-8">
                            <div class="font-black mb-6 q-text">${q.q}</div>
                            <div class="grid grid-cols-1 ${q.opts.length > 2 ? 'sm:grid-cols-2' : ''} gap-4">
                                ${q.opts.map((opt, oIdx) => {
                                    let cls = answered ? (oIdx === q.c ? "correct" : (oIdx === userAnswers[key] ? "wrong" : "opacity-30")) : "";
                                    return `<button onclick="handleAnswer(${qIdx}, ${oIdx})" ${answered ? 'disabled' : ''} class="option-btn w-full p-5 text-left font-black flex justify-between items-center ${cls}"><span>${opt}</span></button>`;
                                }).join('')}
                            </div>
                        </div>`;
                });

                main.innerHTML = `
                    <div class="mb-10 text-center">
                        <h2 class="font-black mb-2 text-4xl" style="color: var(--title-color);">${data.title}</h2>
                        <div class="inline-block bg-white dark:bg-slate-800 px-6 py-2 rounded-full border-2 border-indigo-100 shadow-sm">
                            <p class="font-bold text-slate-500 text-lg">üí° ${data.instr || 'Read carefully and choose!'}</p>
                        </div>
                    </div>
                    <div class="max-w-4xl mx-auto">
                        ${passageHtml}
                        <div class="space-y-6">
                            ${questionsHtml}
                        </div>
                    </div>
                `;
            }
        }

        window.handleAnswer = (qIdx, oIdx) => {
            userAnswers[`${currentPage}-${qIdx}`] = oIdx;
            const isCorrect = oIdx === activeData[currentPage].qs[qIdx].c;
            const toast = document.getElementById('toast');
            toast.innerHTML = isCorrect ? "<span>‚ú®</span> Correct! Well Done!" : "<span>‚ùå</span> Oops! Keep Trying!";
            toast.style.backgroundColor = isCorrect ? "#1dd1a1" : "#ff6b6b";
            toast.style.opacity = "1";
            toast.style.transform = "translateX(-50%) scale(1)";
            
            setTimeout(() => {
                toast.style.opacity = "0";
                toast.style.transform = "translateX(-50%) scale(0.5)";
            }, 1200);
            render();
        };

        function finish() {
            currentView = 'results';
            document.getElementById('quiz-footer').classList.add('hidden');
            document.getElementById('progress-container').classList.add('hidden');
            let total = 0, correct = 0;
            activeData.forEach((p, pi) => p.qs.forEach((q, qi) => { total++; if (userAnswers[`${pi}-${qi}`] === q.c) correct++; }));
            
            const scorePercent = Math.round((correct/total)*100);
            let emoji = scorePercent >= 90 ? "üèÜ" : (scorePercent >= 70 ? "üåü" : "üìñ");
            let msg = scorePercent >= 90 ? "You are a Superstar!" : (scorePercent >= 70 ? "Great Effort!" : "Keep Practicing!");

            document.getElementById('main-view').innerHTML = `
                <div class="max-w-2xl mx-auto text-center py-20 px-10 bg-white dark:bg-slate-800 rounded-[4rem] shadow-2xl mt-10 border-4 border-indigo-100">
                    <div class="text-9xl mb-10 floating">${emoji}</div>
                    <h2 class="text-5xl lg:text-6xl font-black mb-4 text-indigo-600">${msg}</h2>
                    <p class="text-slate-500 font-bold text-2xl mb-12">You finished the practice session!</p>
                    <div class="inline-block bg-indigo-50 dark:bg-slate-700 px-12 py-8 rounded-[3rem] mb-12">
                        <div class="text-7xl font-black text-indigo-700 dark:text-indigo-400">${scorePercent}%</div>
                    </div>
                    <div class="flex flex-col gap-4">
                        <button onclick="goHome()" class="py-6 bg-indigo-600 hover:bg-indigo-700 text-white rounded-[2.5rem] font-black text-2xl transition-all shadow-xl hover:shadow-2xl border-b-8 border-indigo-800 active:border-b-0 active:translate-y-2">Back to Playground</button>
                    </div>
                </div>`;
            window.scrollTo(0, 0);
        }
        render();
    </script>
</body>
</html>

