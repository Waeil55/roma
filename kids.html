<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Merola Website</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap');
        
        :root {
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-color: #000000;
            --title-color: #1e3a8a;
            --instr-color: #334155;
            --border-color: #cbd5e1;
            --primary-action: #1d4ed8;
            --user-font-size: 20px;
        }

        .dark {
            --bg-color: #020617;
            --card-bg: #1e293b;
            --text-color: #ffffff;
            --title-color: #93c5fd;
            --instr-color: #cbd5e1;
            --border-color: #475569;
            --primary-action: #3b82f6;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.2s, color 0.2s;
            overscroll-behavior-y: contain;
        }

        .glass-header {
            background: var(--card-bg);
            border-bottom: 2px solid var(--border-color);
            opacity: 0.98;
        }

        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .q-text {
            font-size: var(--user-font-size) !important;
            color: var(--text-color) !important;
            line-height: 1.6;
        }

        .option-btn {
            font-size: calc(var(--user-font-size) * 0.9) !important;
            transition: all 0.15s ease;
            border: 2px solid var(--border-color);
            background-color: var(--card-bg);
            color: var(--text-color) !important;
        }

        .font-dynamic {
            font-size: var(--user-font-size) !important;
        }

        .instr-text {
            font-size: calc(var(--user-font-size) * 0.8) !important;
            color: var(--instr-color) !important;
        }

        .passage-box {
            background-color: #f0f9ff !important;
            color: #1e3a8a !important; 
            border-left: 6px solid #2563eb;
            padding: 1.25rem;
            border-radius: 1rem;
        }

        .dark .passage-box {
            background-color: #0c4a6e !important;
            color: #f0f9ff !important;
        }

        .correct {
            background-color: #16a34a !important;
            border-color: #16a34a !important;
            color: #ffffff !important;
        }

        .wrong {
            background-color: #dc2626 !important;
            border-color: #dc2626 !important;
            color: #ffffff !important;
        }

        .app-shell {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
        }

        @media (min-width: 768px) {
            .app-shell { max-width: 768px; }
        }

        .header-title {
            color: var(--title-color) !important;
            font-weight: 900;
        }

        .coin-img {
            height: 1.8em;
            display: inline-block;
            vertical-align: middle;
            margin: 0 3px;
            border-radius: 50%;
            background: #fff;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .hub-card {
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }
        .hub-card:active { transform: scale(0.97); }

        .lesson-gradient { background: linear-gradient(135deg, #1e40af, #3b82f6); }
        .coin-gradient { background: linear-gradient(135deg, #065f46, #10b981); }
        .time-gradient { background: linear-gradient(135deg, #7c3aed, #db2777); }
        .math-gradient { background: linear-gradient(135deg, #f59e0b, #ef4444); }
        .shapes-gradient { background: linear-gradient(135deg, #0ea5e9, #6366f1); }
        .grammar-gradient { background: linear-gradient(135deg, #8b5cf6, #ec4899); }

        .clock-svg, .shape-svg {
            width: 120px;
            height: 120px;
            margin: 10px auto;
            display: block;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="glass-header sticky top-0 z-50 px-4 py-2 flex flex-col gap-1 shadow-sm">
        <div class="flex justify-between items-center">
            <div class="flex items-center gap-2">
                <span class="text-xl">üè†</span>
                <h1 class="text-lg header-title">Merola Website</h1>
            </div>
            <div class="flex items-center gap-2">
                <div class="flex items-center bg-gray-200 dark:bg-slate-700 rounded-lg overflow-hidden border border-gray-400 dark:border-slate-500">
                    <button onclick="adjustFont(-2)" class="px-3 py-1 font-black text-slate-900 dark:text-white hover:bg-gray-300 dark:hover:bg-slate-600 transition-colors">-</button>
                    <button onclick="adjustFont(2)" class="px-3 py-1 font-black text-slate-900 dark:text-white hover:bg-gray-300 dark:hover:bg-slate-600 transition-colors">+</button>
                </div>
                <button onclick="toggleTheme()" class="p-2 rounded-lg bg-gray-100 dark:bg-slate-800 border border-gray-400 dark:border-slate-500 shadow-sm">
                    <span id="theme-icon">‚ú®</span>
                </button>
                <button onclick="goHome()" class="p-2 rounded-lg bg-gray-100 dark:bg-slate-800 border border-gray-400 dark:border-slate-500 shadow-sm">
                    <span>üè†</span>
                </button>
            </div>
        </div>
        <div id="progress-container" class="hidden flex justify-between items-center text-[10px] uppercase tracking-widest font-bold opacity-80">
            <span id="page-indicator" class="instr-text">Page 1</span>
            <div class="flex-grow h-1.5 bg-gray-300 dark:bg-gray-700 rounded-full mx-3 overflow-hidden">
                <div id="progress-bar" class="bg-blue-600 h-full transition-all duration-500" style="width: 0%"></div>
            </div>
        </div>
    </header>

    <main class="flex-grow app-shell px-4 py-6 mb-24">
        <div id="main-view"></div>
    </main>

    <footer id="quiz-footer" class="hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-slate-900 border-t border-gray-200 dark:border-slate-800 p-3 flex gap-3 z-40 shadow-lg">
        <button onclick="handleBack()" id="prev-btn" class="flex-1 py-4 bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 rounded-2xl font-bold">Back</button>
        <button onclick="nextPage()" id="next-btn" class="flex-1 py-4 bg-blue-700 text-white rounded-2xl font-bold shadow-lg">Next</button>
    </footer>

    <div id="toast" class="fixed top-20 left-1/2 -translate-x-1/2 px-6 py-2 rounded-full text-white font-bold shadow-2xl transition-all duration-300 opacity-0 pointer-events-none z-[60]"></div>

    <script>
        const COIN_URLS = {
            c1: "https://raw.githubusercontent.com/Waeil55/roma/main/1.PNG",
            c5: "https://raw.githubusercontent.com/Waeil55/roma/main/5.PNG",
            c10: "https://raw.githubusercontent.com/Waeil55/roma/main/10.PNG",
            c25: "https://raw.githubusercontent.com/Waeil55/roma/main/25.PNG",
            c100: "https://raw.githubusercontent.com/Waeil55/roma/main/1dollar.PNG"
        };

        const getCoin = (key) => `<img src="${COIN_URLS[key]}" class="coin-img" alt="${key}">`;

        function getClockSVG(h, m) {
            const hDeg = (h % 12 + m / 60) * 30;
            const mDeg = m * 6;
            return `
            <svg class="clock-svg" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="45" fill="white" stroke="#333" stroke-width="2"/>
                ${[12, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11].map((n, i) => {
                    const ang = (i * 30) * Math.PI / 180;
                    return `<text x="${50 + 35 * Math.sin(ang)}" y="${52 - 35 * Math.cos(ang)}" font-size="8" text-anchor="middle" fill="#333" font-weight="bold">${n}</text>`;
                }).join('')}
                <line x1="50" y1="50" x2="50" y2="25" stroke="#000" stroke-width="3" stroke-linecap="round" transform="rotate(${hDeg} 50 50)"/>
                <line x1="50" y1="50" x2="50" y2="15" stroke="#333" stroke-width="2" stroke-linecap="round" transform="rotate(${mDeg} 50 50)"/>
                <circle cx="50" cy="50" r="2" fill="#000"/>
            </svg>`;
        }

        function getShapeSVG(type) {
            const shapes = {
                circle: '<circle cx="50" cy="50" r="40" fill="#3b82f6" stroke="#1e3a8a" stroke-width="2"/>',
                square: '<rect x="15" y="15" width="70" height="70" fill="#ef4444" stroke="#7f1d1d" stroke-width="2"/>',
                triangle: '<polygon points="50,15 90,85 10,85" fill="#10b981" stroke="#064e3b" stroke-width="2"/>',
                rectangle: '<rect x="10" y="25" width="80" height="50" fill="#f59e0b" stroke="#78350f" stroke-width="2"/>',
                star: '<polygon points="50,5 63,35 95,35 70,55 80,85 50,65 20,85 30,55 5,35 37,35" fill="#8b5cf6" stroke="#4c1d95" stroke-width="2"/>',
                sphere: '<circle cx="50" cy="50" r="40" fill="url(#sphereGrad)"/><defs><radialGradient id="sphereGrad" cx="30%" cy="30%" r="50%"><stop offset="0%" stop-color="#93c5fd"/><stop offset="100%" stop-color="#1e3a8a"/></radialGradient></defs>',
                cube: '<path d="M20 30 l30 -10 l30 10 v40 l-30 10 l-30 -10 z" fill="#fb7185" stroke="#881337" stroke-width="2"/><path d="M20 30 l30 10 l30 -10 M50 40 v40" fill="none" stroke="#881337" stroke-width="2"/>',
                cone: '<ellipse cx="50" cy="80" rx="30" ry="10" fill="#fbbf24" stroke="#92400e" stroke-width="2"/><path d="M20 80 L50 20 L80 80" fill="#fbbf24" stroke="#92400e" stroke-width="2"/>',
                cylinder: '<ellipse cx="50" cy="25" rx="30" ry="10" fill="#2dd4bf" stroke="#115e59" stroke-width="2"/><path d="M20 25 v50 a30 10 0 0 0 60 0 v-50" fill="#2dd4bf" stroke="#115e59" stroke-width="2"/><ellipse cx="50" cy="75" rx="30" ry="10" fill="none" stroke="#115e59" stroke-width="2" stroke-dasharray="2 2"/>',
                pyramid: '<polygon points="50,15 85,85 15,85" fill="#a855f7" stroke="#581c87" stroke-width="2"/><line x1="50" y1="15" x2="50" y2="85" stroke="#581c87" stroke-width="1"/>'
            };
            return `<svg class="shape-svg" viewBox="0 0 100 100">${shapes[type] || ''}</svg>`;
        }

        const lessonData = [
            {
                title: "Page 1: Antonyms",
                instr: "Choose the word that means the opposite of the underlined word.",
                qs: [
                    { q: "1. a <u>problem</u>", opts: ["solution", "worry", "math", "sentence"], c: 0 },
                    { q: "2. was <u>loose</u>", opts: ["tight", "large", "big", "win"], c: 0 },
                    { q: "3. a <u>question</u>", opts: ["word", "poem", "answer", "talk"], c: 2 },
                    { q: "4. was <u>fact</u>", opts: ["true", "real", "scary", "fiction"], c: 3 },
                    { q: "5. was <u>straight</u>", opts: ["bent", "tall", "narrow", "long"], c: 0 },
                    { q: "6. to <u>create</u>", opts: ["make", "build", "destroy", "draw"], c: 2 },
                    { q: "7. was <u>shiny</u>", opts: ["dull", "bright", "pretty", "ugly"], c: 0 },
                    { q: "8. to <u>listen</u>", opts: ["hear", "ignore", "touch", "eat"], c: 1 }
                ]
            },
            {
                title: "Page 2: Homographs",
                instr: "Choose the word that correctly completes BOTH sentences.",
                qs: [
                    { q: "1. She counted all the ___ in her purse.<br>He will ___ clothes before practice.", opts: ["coins", "change", "buy", "money"], c: 1 },
                    { q: "2. I will ___ a movie before bed.<br>Use your ___ to tell the time.", opts: ["watch", "clock", "see", "rent"], c: 0 },
                    { q: "3. If it gets too hot, turn on the ___.<br>I am a big ___ of the basketball team.", opts: ["fan", "air", "player", "water"], c: 0 },
                    { q: "4. Don't forget to ___ your bag.<br>Buy a ___ of gum at the store.", opts: ["stick", "pack", "bring", "use"], c: 1 },
                    { q: "5. She ___ school every day at 3:00.<br>In the fall, rake the ___.", opts: ["grass", "leaves", "visits", "flowers"], c: 1 },
                    { q: "6. We took a ___ to the fair.<br>You can ___ your dog to do tricks.", opts: ["car", "teach", "train", "bus"], c: 2 },
                    { q: "7. Learn about ___ in science class.<br>Floss the ___ between your teeth.", opts: ["plants", "letter", "water", "space"], c: 3 },
                    { q: "8. Don't ___ in front of others.<br>___ the paper into four squares.", opts: ["tear", "rip", "cut", "hit"], c: 2 }
                ]
            },
            {
                title: "Page 3: Prefixes",
                instr: "For numbers 1-4, find the word that has the prefix underlined. For 5-8, match the definition.",
                qs: [
                    { q: "1. Find underlined prefix:", opts: ["<u>un</u>fair", "disappear", "safely", "misplace"], c: 0 },
                    { q: "2. Find underlined prefix:", opts: ["dislike", "helpless", "<u>re</u>wind", "unhappy"], c: 2 },
                    { q: "3. Find underlined prefix:", opts: ["softly", "<u>pre</u>heat", "premade", "unload"], c: 1 },
                    { q: "4. Find underlined prefix:", opts: ["<u>re</u>make", "dislike", "playful", "kindness"], c: 0 },
                    { q: "5. tie again", opts: ["retie", "untie", "distie", "mistie"], c: 0 },
                    { q: "6. spell wrong", opts: ["unspell", "misspell", "prespell", "disspell"], c: 1 },
                    { q: "7. to not agree", opts: ["unagree", "reagree", "misagree", "disagree"], c: 3 },
                    { q: "8. not even", opts: ["reeven", "diseven", "miseven", "uneven"], c: 3 }
                ]
            },
            {
                title: "Page 4: Suffixes",
                instr: "For numbers 1-4, find the word that has the suffix underlined. For 5-8, match the definition.",
                qs: [
                    { q: "1. Find underlined suffix:", opts: ["friendly", "worth<u>less</u>", "undo", "replay"], c: 1 },
                    { q: "2. Find underlined suffix:", opts: ["helpless", "weak<u>ness</u>", "displease", "wildly"], c: 1 },
                    { q: "3. Find underlined suffix:", opts: ["mistake", "harmless", "help<u>ful</u>", "redo"], c: 2 },
                    { q: "4. Find underlined suffix:", opts: ["teach<u>er</u>", "painter", "badly", "careful"], c: 0 },
                    { q: "5. without a home", opts: ["homeness", "homeful", "homeless", "homely"], c: 2 },
                    { q: "6. full of color", opts: ["colorly", "colorful", "colorness", "colorless"], c: 1 },
                    { q: "7. in a quick way", opts: ["quickless", "quickly", "quickful", "quicker"], c: 1 },
                    { q: "8. one who leads", opts: ["leader", "leadless", "leadly", "leadful"], c: 0 }
                ]
            },
            {
                title: "Page 5-6: Phonics & Mixed Practice",
                instr: "Follow the auditory directions or read the words provided.",
                qs: [
                    { q: "1. Same beginning sound as <u>duck</u>:", opts: ["drop", "door", "dig"], c: 2 },
                    { q: "2. Same beginning sound as <u>shoe</u>:", opts: ["slip", "shop", "school"], c: 1 },
                    { q: "3. Same ending sound as <u>bed</u>:", opts: ["ready", "door", "lead"], c: 2 },
                    { q: "4. Same ending sound as <u>back</u>:", opts: ["check", "lunch", "camp"], c: 0 },
                    { q: "5. Same middle sound as <b>chart</b>:", opts: ["past", "brain", "tray", "farm"], c: 3 },
                    { q: "6. Same middle sound as <b>feet</b>:", opts: ["met", "them", "treat", "there"], c: 2 },
                    { q: "7. Synonym of <u>fast</u>:", opts: ["slow", "race", "quick", "run"], c: 2 },
                    { q: "8. Antonym of <u>outside</u>:", opts: ["under", "playing", "next", "inside"], c: 3 },
                    { q: "9. Please ___ papers / never been to that ___.", opts: ["put", "place", "school", "lay"], c: 1 },
                    { q: "10. turn ___ / answers ___ on test.", opts: ["left", "correct", "right", "around"], c: 2 },
                    { q: "11. Find underlined suffix:", opts: ["illness", "hope<u>ful</u>", "misplace", "beautiful"], c: 1 },
                    { q: "12. math ___ tomorrow:", opts: ["book", "test", "paper", "homework"], c: 1 },
                    { q: "13. questions ___ on test:", opts: ["right", "answers", "wrong", "grade"], c: 2 }
                ]
            },
            {
                title: "Pages 7-8: Penguins",
                passage: "Most penguins live in a land of snow and ice. They have feathers, wings, and a beak... But they are different in two important ways. Penguins cannot fly. A penguin body is too heavy... In the water they use their webbed feet to help them swim... They eat shrimplike animals called krill. Penguins lay eggs like all birds... Both the mother and father penguin feed the baby.",
                qs: [
                    { q: "1. Which sentence DOES NOT tell how they move?", opts: ["funny waddle", "flop down slide", "make nest pebbles", "webbed feet swim"], c: 2 },
                    { q: "2. Meaning of <b>swiftly</b>:", opts: ["carefully", "quickly", "slowly", "safely"], c: 1 },
                    { q: "3. <b>Krill</b> means:", opts: ["eggs", "fish", "shrimplike animals", "babies"], c: 2 },
                    { q: "4. Fact about penguins:", opts: ["bad swimmers", "like other birds", "wings help swim", "only mothers"], c: 2 },
                    { q: "5. Find underlined suffix:", opts: ["swiftly", "walk<u>ing</u>", "cannot", "covered"], c: 1 },
                    { q: "6. Why can't they fly?", opts: ["no wings", "too heavy", "rather swim", "too tall"], c: 1 },
                    { q: "7. Which is NOT true about chicks?", opts: ["hatch eggs", "both parents feed", "covered feathers", "find food now"], c: 3 }
                ]
            },
            {
                title: "Pages 9-10: Wright Brothers",
                passage: "Orville and Wilbur Wright owned a bicycle shop in Dayton, Ohio. In 1899, they began to experiment with flight using kites and gliders... teaches them how an airplane should rise and return. In 1903, they took the first motor-powered flight for 12 seconds. They continued until they could stay for over an hour.",
                qs: [
                    { q: "8. Main idea:", opts: ["testing bad", "flyer first", "early pilots", "bike shop"], c: 2 },
                    { q: "9. <b>Experiment</b>:", opts: ["try new ideas", "test kites", "stay in air", "fly airplane"], c: 0 },
                    { q: "10. How did they learn?", opts: ["read books", "learn others", "test kites/gliders", "small engine"], c: 2 },
                    { q: "11. How long did it last?", opts: ["12 seconds", "Dec 17", "1899", "1000 mins"], c: 0 },
                    { q: "12. Opposite of started:", opts: ["began", "finished", "first", "continued"], c: 1 },
                    { q: "13. Opinion:", opts: ["tested kites", "flight 1903", "very smart", "flyer first"], c: 2 },
                    { q: "14. Find underlined prefix:", opts: ["experiment", "interested", "<u>re</u>turn", "owned"], c: 2 }
                ]
            },
            {
                title: "Pages 11-12: My Shadow",
                passage: "I HAVE a little shadow that goes in and out with me... He is very, very like me from the heels up to the head... The funniest thing about him is the way he likes to grow... he stays so close beside me, he's a coward you can see... one morning, very early... my lazy little shadow... had stayed at home behind me.",
                qs: [
                    { q: "1. Poem focus:", opts: ["goes school", "bird shadows", "relationship shadow", "get lost"], c: 2 },
                    { q: "2. Feeling:", opts: ["afraid", "bored", "amused", "quiet"], c: 2 },
                    { q: "3. Difference:", opts: ["grow/shrink", "jump up down", "find dew", "play inside"], c: 0 },
                    { q: "4. Last stanza (lines 13-16):", opts: ["speaker sleeps", "meets friend", "shadow stays home", "shadow larger"], c: 2 },
                    { q: "5. Why write it?", opts: ["explain animals", "warn losing", "entertain readers", "inform types"], c: 2 },
                    { q: "6. Which is true?", opts: ["grows slowly", "same size", "is a coward", "not like speaker"], c: 2 },
                    { q: "7. Speaker is likely a:", opts: ["dog", "mother", "teacher", "child"], c: 3 }
                ]
            },
            {
                title: "Pages 13-14: Uncle Wilber",
                passage: "Our Uncle Wilber is a little strange. He sent a goldfish named Oscar. Friday he came to take Oscar home. He left a thank-you present. The box is full of holes and says 'Be Careful'. It hisses too. Sid was nervous, but Sarah lifted the lid... Eeeeek!",
                qs: [
                    { q: "8. What happened Friday?", opts: ["got fish", "got letter", "picked up Oscar", "vacation"], c: 2 },
                    { q: "9. How did Sid feel?", opts: ["excited", "nervous", "angry", "sad"], c: 1 },
                    { q: "10. Describe Wilber:", opts: ["weird", "rude", "greedy", "selfish"], c: 0 },
                    { q: "11. Why send Oscar?", opts: ["give gift", "not want Oscar", "extra fish", "going away"], c: 3 },
                    { q: "12. Opposite of slowly:", opts: ["carefully", "quickly", "happily", "sadly"], c: 1 },
                    { q: "13. Same as strange:", opts: ["regular", "scary", "weird", "funny"], c: 2 }
                ]
            },
            {
                title: "Page 16: Synonyms",
                instr: "Choose the word that means about the same.",
                qs: [
                    { q: "1. was <u>old</u>", opts: ["new", "ancient", "young", "dirty"], c: 1 },
                    { q: "2. was <u>quiet</u>", opts: ["loud", "silent", "noisy", "yelling"], c: 1 },
                    { q: "3. was <u>thin</u>", opts: ["narrow", "wide", "short", "tall"], c: 0 },
                    { q: "4. was <u>unusual</u>", opts: ["regular", "normal", "strange", "same"], c: 2 },
                    { q: "5. was <u>shiny</u>", opts: ["bright", "dull", "new", "pretty"], c: 0 },
                    { q: "6. was <u>normal</u>", opts: ["regular", "different", "odd", "weird"], c: 0 },
                    { q: "7. was <u>neat</u>", opts: ["good", "messy", "dirty", "tidy"], c: 3 },
                    { q: "8. was <u>honest</u>", opts: ["lying", "truthful", "wrong", "dishonest"], c: 1 }
                ]
            },
            {
                title: "Page 17: Context Clues",
                instr: "Read the story and fill in the blanks.",
                passage: "My family is going on a (1) trip. We will (2) to the beach in our car. Some people like to (3) soda and eat candy. You should (4) brush your teeth. We are going to learn (6) animals. I do not have (7) time to finish my book. I will read (8) tomorrow.",
                qs: [
                    { q: "1. Blank (1):", opts: ["large", "clean", "special", "hard"], c: 2 },
                    { q: "2. Blank (2):", opts: ["swim", "travel", "together", "bring"], c: 1 },
                    { q: "3. Blank (3):", opts: ["drink", "carry", "start", "bring"], c: 0 },
                    { q: "4. Blank (4):", opts: ["never", "begin", "better", "always"], c: 3 },
                    { q: "6. Blank (6):", opts: ["some", "again", "long", "about"], c: 3 },
                    { q: "7. Blank (7):", opts: ["once", "enough", "yesterday", "real"], c: 1 },
                    { q: "8. Blank (8):", opts: ["later", "soon", "yesterday", "until"], c: 0 }
                ]
            }
        ];

        const initialCoinData = [
            { q: `${getCoin('c1')} + ${getCoin('c1')} + ${getCoin('c1')}`, opts: ["2 cents", "3 cents", "5 cents", "10 cents"], c: 1 },
            { q: `${getCoin('c5')} + ${getCoin('c5')}`, opts: ["5 cents", "10 cents", "25 cents", "2 cents"], c: 1 },
            { q: `${getCoin('c25')} + ${getCoin('c10')}`, opts: ["30 cents", "35 cents", "40 cents", "25 cents"], c: 1 },
            { q: `${getCoin('c100')} - ${getCoin('c25')}`, opts: ["75 cents", "50 cents", "25 cents", "100 cents"], c: 0 },
            { q: `${getCoin('c25')} + ${getCoin('c25')} + ${getCoin('c25')} + ${getCoin('c25')}`, opts: ["50 cents", "75 cents", "$1.00", "$2.00"], c: 2 },
            { q: `${getCoin('c10')} + ${getCoin('c5')} + ${getCoin('c1')}`, opts: ["15 cents", "16 cents", "20 cents", "11 cents"], c: 1 },
            { q: `${getCoin('c100')} + ${getCoin('c100')} + ${getCoin('c25')}`, opts: ["$1.25", "$2.25", "$3.00", "$2.50"], c: 1 },
            { q: `${getCoin('c100')} + ${getCoin('c100')} + ${getCoin('c100')} - ${getCoin('c100')}`, opts: ["$1.00", "$2.00", "$3.00", "$0.00"], c: 1 },
            { q: `${getCoin('c100')} + ${getCoin('c10')} + ${getCoin('c10')} + ${getCoin('c5')}`, opts: ["$1.20", "$1.25", "$1.30", "$1.15"], c: 1 },
            { q: `${getCoin('c100')} + ${getCoin('c100')} + ${getCoin('c5')} + ${getCoin('c1')}`, opts: ["$2.05", "$2.10", "$2.06", "$2.15"], c: 2 },
            { q: `${getCoin('c100')} - ${getCoin('c10')} - ${getCoin('c10')}`, opts: ["90 cents", "80 cents", "70 cents", "100 cents"], c: 1 },
            { q: `${getCoin('c100')} + ${getCoin('c100')} + ${getCoin('c25')} + ${getCoin('c10')} + ${getCoin('c5')}`, opts: ["$2.40", "$2.50", "$2.35", "$2.45"], c: 0 },
            { q: `${getCoin('c100')} + ${getCoin('c100')} + ${getCoin('c100')} + ${getCoin('c100')}`, opts: ["$3.00", "$4.00", "$5.00", "$2.00"], c: 1 },
            { q: `${getCoin('c25')} + ${getCoin('c25')} + ${getCoin('c25')}`, opts: ["50 cents", "75 cents", "$1.00", "25 cents"], c: 1 },
            { q: `${getCoin('c10')} + ${getCoin('c10')} + ${getCoin('c10')} + ${getCoin('c10')}`, opts: ["30 cents", "40 cents", "50 cents", "20 cents"], c: 1 },
            { q: `${getCoin('c100')} + ${getCoin('c25')} + ${getCoin('c1')}`, opts: ["$1.25", "$1.26", "$1.30", "$1.01"], c: 1 }
        ];

        function generateTimeData() {
            const times = [];
            for (let i = 0; i < 100; i++) {
                const h = Math.floor(Math.random() * 12) + 1;
                const m = Math.floor(Math.random() * 12) * 5;
                const correctStr = `${h}:${m.toString().padStart(2, '0')}`;
                const opts = new Set([correctStr]);
                while (opts.size < 4) {
                    const dh = Math.floor(Math.random() * 12) + 1;
                    const dm = Math.floor(Math.random() * 12) * 5;
                    opts.add(`${dh}:${dm.toString().padStart(2, '0')}`);
                }
                const sortedOpts = Array.from(opts).sort();
                times.push({ q: `What time is it now?<br>${getClockSVG(h, m)}`, opts: sortedOpts, c: sortedOpts.indexOf(correctStr) });
            }
            return times;
        }

        function generateMathData() {
            const math = [];
            for (let i = 0; i < 150; i++) {
                const op = Math.random() > 0.5 ? '+' : '-';
                let a, b, res;
                if (op === '+') { a = Math.floor(Math.random() * 101); b = Math.floor(Math.random() * (101 - a)); res = a + b; }
                else { a = Math.floor(Math.random() * 101); b = Math.floor(Math.random() * (a + 1)); res = a - b; }
                const correct = res.toString();
                const opts = new Set([correct]);
                while (opts.size < 4) opts.add((res + Math.floor(Math.random() * 20) - 10).toString());
                const sortedOpts = Array.from(opts).sort((x, y) => parseInt(x) - parseInt(y));
                math.push({ q: `Calculate: ${a} ${op} ${b} = ?`, opts: sortedOpts, c: sortedOpts.indexOf(correct) });
            }
            return math;
        }

        function generateShapesData() {
            const list = [];
            const names = ["circle", "square", "triangle", "rectangle", "star", "sphere", "cube", "cone", "cylinder", "pyramid"];
            for (let i = 0; i < 120; i++) {
                const type = names[Math.floor(Math.random() * names.length)];
                const correct = type.charAt(0).toUpperCase() + type.slice(1);
                list.push({
                    q: `What shape is this?<br>${getShapeSVG(type)}`,
                    opts: ["Circle", "Square", "Triangle", "Rectangle", "Star", "Sphere", "Cube", "Cone", "Cylinder", "Pyramid"].sort(),
                    c: ["Circle", "Square", "Triangle", "Rectangle", "Star", "Sphere", "Cube", "Cone", "Cylinder", "Pyramid"].sort().indexOf(correct)
                });
            }
            return list;
        }

        function generateGrammarData() {
            const nouns = ["Dog", "Apple", "Teacher", "School", "Book", "Park", "Cat", "Ball", "Table", "Chair", "Car", "Tree"];
            const verbs = ["Run", "Jump", "Eat", "Sleep", "Sing", "Dance", "Write", "Read", "Swim", "Play", "Laugh", "Walk"];
            const list = [];
            for (let i = 0; i < 120; i++) {
                const isNoun = Math.random() > 0.5;
                const word = isNoun ? nouns[Math.floor(Math.random() * nouns.length)] : verbs[Math.floor(Math.random() * verbs.length)];
                list.push({
                    q: `Is the word "<b>${word}</b>" a Noun or a Verb?`,
                    opts: ["Noun", "Verb"],
                    c: isNoun ? 0 : 1
                });
            }
            return list;
        }

        let currentView = 'home'; 
        let activeData = [];
        let currentPage = 0;
        let userAnswers = {};
        let fontSize = 20;
        let isDarkMode = false;

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark', isDarkMode);
            document.getElementById('theme-icon').innerText = isDarkMode ? '‚òÄÔ∏è' : '‚ú®';
        }

        function goHome() {
            currentView = 'home';
            render();
        }

        function adjustFont(val) {
            fontSize = Math.max(16, Math.min(48, fontSize + val));
            document.documentElement.style.setProperty('--user-font-size', `${fontSize}px`);
            render();
        }

        function startSection(type) {
            let baseData = [];
            let perPage = 5;
            if (type === 'lesson') { activeData = lessonData; }
            else if (type === 'coin') { baseData = shuffle([...initialCoinData]); perPage = 2; }
            else if (type === 'time') { baseData = shuffle(generateTimeData()); perPage = 8; }
            else if (type === 'math') { baseData = shuffle(generateMathData()); perPage = 10; }
            else if (type === 'shapes') { baseData = shuffle(generateShapesData()); perPage = 5; }
            else if (type === 'grammar') { baseData = shuffle(generateGrammarData()); perPage = 10; }

            if (type !== 'lesson') {
                activeData = [];
                for (let i = 0; i < baseData.length; i += perPage) {
                    activeData.push({ 
                        title: `${type.charAt(0).toUpperCase() + type.slice(1)} Lab - Page ${activeData.length + 1}`, 
                        instr: "Select the correct answer below.", 
                        qs: baseData.slice(i, i + perPage) 
                    });
                }
            }
            currentPage = 0;
            userAnswers = {};
            currentView = 'quiz';
            render();
        }

        function handleBack() {
            if (currentPage > 0) { currentPage--; render(); }
            else goHome();
        }

        function nextPage() {
            if (currentPage < activeData.length - 1) { currentPage++; render(); }
            else finish();
        }

        function render() {
            const main = document.getElementById('main-view');
            const footer = document.getElementById('quiz-footer');
            const progress = document.getElementById('progress-container');

            if (currentView === 'home') {
                footer.classList.add('hidden');
                progress.classList.add('hidden');
                main.innerHTML = `
                    <div class="text-center py-8">
                        <h2 class="text-4xl font-black mb-2 text-blue-600 dark:text-blue-400">Merola Study Hub</h2>
                        <p class="text-lg font-bold text-slate-500 mb-10">Pick a section to start practicing.</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div onclick="startSection('lesson')" class="hub-card lesson-gradient p-8 rounded-[2rem] text-white flex items-center justify-between shadow-xl">
                                <div class="text-left"><h3 class="text-2xl font-black mb-1">Lesson Mastery</h3><p class="opacity-90 font-medium">Full PDF Review</p></div>
                                <div class="text-5xl">üìö</div>
                            </div>
                            <div onclick="startSection('coin')" class="hub-card coin-gradient p-8 rounded-[2rem] text-white flex items-center justify-between shadow-xl">
                                <div class="text-left"><h3 class="text-2xl font-black mb-1">Coin Math Lab</h3><p class="opacity-90 font-medium">Money Counting</p></div>
                                <div class="text-5xl">ü™ô</div>
                            </div>
                            <div onclick="startSection('time')" class="hub-card time-gradient p-8 rounded-[2rem] text-white flex items-center justify-between shadow-xl">
                                <div class="text-left"><h3 class="text-2xl font-black mb-1">Time Lab</h3><p class="opacity-90 font-medium">Read the Clock</p></div>
                                <div class="text-5xl">‚è∞</div>
                            </div>
                            <div onclick="startSection('math')" class="hub-card math-gradient p-8 rounded-[2rem] text-white flex items-center justify-between shadow-xl">
                                <div class="text-left"><h3 class="text-2xl font-black mb-1">Math Lab</h3><p class="opacity-90 font-medium">150+ Math Problems</p></div>
                                <div class="text-5xl">‚ûï</div>
                            </div>
                            <div onclick="startSection('shapes')" class="hub-card shapes-gradient p-8 rounded-[2rem] text-white flex items-center justify-between shadow-xl">
                                <div class="text-left"><h3 class="text-2xl font-black mb-1">Shapes Lab</h3><p class="opacity-90 font-medium">2D & 3D Geometry</p></div>
                                <div class="text-5xl">üî∑</div>
                            </div>
                            <div onclick="startSection('grammar')" class="hub-card grammar-gradient p-8 rounded-[2rem] text-white flex items-center justify-between shadow-xl">
                                <div class="text-left"><h3 class="text-2xl font-black mb-1">Grammar Lab</h3><p class="opacity-90 font-medium">Noun vs Verb</p></div>
                                <div class="text-5xl">‚úçÔ∏è</div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentView === 'quiz') {
                footer.classList.remove('hidden');
                progress.classList.remove('hidden');
                const data = activeData[currentPage];
                document.getElementById('page-indicator').innerText = `Page ${currentPage + 1} of ${activeData.length}`;
                document.getElementById('progress-bar').style.width = `${((currentPage + 1) / activeData.length) * 100}%`;

                let html = `<div class="mb-4"><h2 class="font-black mb-1 text-2xl" style="color: var(--title-color);">${data.title}</h2><p class="font-bold instr-text">${data.instr || ''}</p></div>`;
                if (data.passage) html += `<div class="passage-box mb-6"><p class="font-bold font-dynamic">${data.passage}</p></div>`;

                data.qs.forEach((q, qIdx) => {
                    const key = `${currentPage}-${qIdx}`;
                    const answered = userAnswers[key] !== undefined;
                    html += `
                        <div class="card rounded-3xl p-6 mb-4 shadow-sm">
                            <div class="font-bold mb-5 q-text">${q.q}</div>
                            <div class="space-y-3">
                                ${q.opts.map((opt, oIdx) => {
                                    let cls = answered ? (oIdx === q.c ? "correct" : (oIdx === userAnswers[key] ? "wrong" : "opacity-30")) : "";
                                    return `<button onclick="handleAnswer(${qIdx}, ${oIdx})" ${answered ? 'disabled' : ''} class="option-btn w-full p-5 text-left rounded-2xl font-black flex justify-between items-center ${cls}"><span>${opt}</span></button>`;
                                }).join('')}
                            </div>
                        </div>`;
                });
                main.innerHTML = html;
                window.scrollTo(0, 0);
            }
        }

        window.handleAnswer = (qIdx, oIdx) => {
            userAnswers[`${currentPage}-${qIdx}`] = oIdx;
            const isCorrect = oIdx === activeData[currentPage].qs[qIdx].c;
            const toast = document.getElementById('toast');
            toast.innerText = isCorrect ? "Correct!" : "Try Again!";
            toast.style.backgroundColor = isCorrect ? "#16a34a" : "#dc2626";
            toast.style.opacity = "1";
            setTimeout(() => toast.style.opacity = "0", 1000);
            render();
        };

        function finish() {
            currentView = 'results';
            document.getElementById('quiz-footer').classList.add('hidden');
            document.getElementById('progress-container').classList.add('hidden');
            let total = 0, correct = 0;
            activeData.forEach((p, pi) => p.qs.forEach((q, qi) => { total++; if (userAnswers[`${pi}-${qi}`] === q.c) correct++; }));
            document.getElementById('main-view').innerHTML = `
                <div class="text-center py-12 px-6 bg-white dark:bg-slate-800 rounded-[3rem] shadow-2xl">
                    <div class="text-8xl mb-6">üéñÔ∏è</div>
                    <h2 class="text-4xl font-black mb-2 text-blue-600">Session Complete!</h2>
                    <div class="text-7xl font-black text-blue-700 mb-8">${Math.round((correct/total)*100)}%</div>
                    <button onclick="goHome()" class="w-full py-6 bg-blue-600 text-white rounded-[2rem] font-black text-xl">Back to Hub</button>
                </div>`;
        }
        render();
    </script>
</body>
</html>

