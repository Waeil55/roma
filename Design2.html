<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ü§™ Merola's Super-Duper Fun Lab!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bubblegum+Sans&family=Comic+Neue:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #FFEFD5; /* Papaya Whip */
            --card-bg: #ffffff;
            --text-color: #2D3436;
            --title-color: #FF6B6B; 
            --instr-color: #4834D4;
            --border-color: #FFBE76;
            --primary-action: #6C5CE7;
            --user-font-size: 22px;
        }

        .dark {
            --bg-color: #2D3436;
            --card-bg: #636E72;
            --text-color: #FAB1A0;
            --title-color: #55E6C1; 
            --instr-color: #FD79A8;
            --border-color: #E17055;
            --primary-action: #00CEC9;
        }

        body {
            font-family: 'Bubblegum Sans', cursive;
            background-color: var(--bg-color);
            color: var(--text-color);
            background-image: radial-gradient(#FFBE76 1px, transparent 1px);
            background-size: 30px 30px;
            transition: all 0.3s ease;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" style="font-size:24px"><text y="24">üç≠</text></svg>'), auto;
        }

        @keyframes wiggle {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(-2deg); }
            75% { transform: rotate(2deg); }
            100% { transform: rotate(0deg); }
        }

        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .glass-header {
            background: #FFEAA7;
            border-bottom: 6px dashed #FAB1A0;
            border-radius: 0 0 30px 30px;
        }

        .card {
            background-color: var(--card-bg);
            border: 4px solid var(--border-color);
            border-radius: 40px;
            box-shadow: 10px 10px 0px var(--border-color);
            transition: all 0.2s;
        }

        .card:hover {
            transform: translateY(-5px) rotate(1deg);
        }

        .q-text {
            font-size: var(--user-font-size) !important;
            color: var(--text-color) !important;
            font-family: 'Comic Neue', cursive;
            font-weight: 900;
        }

        .option-btn {
            font-size: calc(var(--user-font-size) * 0.9) !important;
            border: 3px solid var(--border-color);
            border-radius: 25px;
            background: #fff;
            box-shadow: 0 6px 0 var(--border-color);
            margin-bottom: 8px;
        }

        .option-btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 var(--border-color);
        }

        .passage-box {
            background: #DFF9FB !important;
            border: 4px dotted #3498DB !important;
            border-radius: 30px !important;
            position: relative;
        }

        .passage-box::before {
            content: "üìñ Read This! üìñ";
            position: absolute;
            top: -15px;
            left: 20px;
            background: #3498DB;
            color: white;
            padding: 2px 15px;
            border-radius: 10px;
            font-size: 14px;
        }

        .correct {
            background: #55EFC4 !important;
            border-color: #00B894 !important;
            animation: pop 0.3s infinite;
        }

        .wrong {
            background: #FF7675 !important;
            border-color: #D63031 !important;
        }

        .hub-card {
            border-radius: 40px;
            border: 5px solid rgba(255,255,255,0.4);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .hub-card:hover {
            transform: scale(1.08) rotate(-2deg);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
        }

        /* Rainbow Buttons */
        .lesson-gradient { background: linear-gradient(135deg, #FF9F43, #FF6B6B); }
        .coin-gradient { background: linear-gradient(135deg, #1DD1A1, #10AC84); }
        .time-gradient { background: linear-gradient(135deg, #54A0FF, #2E86DE); }
        .math-gradient { background: linear-gradient(135deg, #FECA57, #FF9F43); }
        .shapes-gradient { background: linear-gradient(135deg, #FF9FF3, #F368E0); }
        .grammar-gradient { background: linear-gradient(135deg, #48DBFB, #0ABDE3); }

        .coin-img {
            filter: drop-shadow(3px 3px 0px rgba(0,0,0,0.1));
            animation: wiggle 2s infinite ease-in-out;
        }

        /* Scrollbar Fun */
        ::-webkit-scrollbar { width: 12px; }
        ::-webkit-scrollbar-track { background: #FFEFD5; }
        ::-webkit-scrollbar-thumb { background: #FF6B6B; border-radius: 10px; border: 3px solid #FFEFD5; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="glass-header sticky top-0 z-50 px-4 py-4 flex flex-col gap-2 shadow-xl">
        <div class="app-shell flex justify-between items-center w-full max-w-5xl mx-auto">
            <div class="flex items-center gap-3">
                <span class="text-4xl animate-bounce">üéà</span>
                <div>
                    <h1 class="text-xl sm:text-2xl font-black text-orange-600 tracking-tighter" style="font-family: 'Comic Neue';">MEROLA'S FUN LAB!</h1>
                    <p class="text-[10px] font-bold text-blue-500 uppercase">Learning is a Party! ü•≥</p>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <div class="flex items-center bg-white rounded-full p-1 border-2 border-orange-400">
                    <button onclick="adjustFont(-2)" class="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center font-black hover:bg-orange-200">üîç-</button>
                    <button onclick="adjustFont(2)" class="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center font-black hover:bg-orange-200 ml-1">üîç+</button>
                </div>
                <button onclick="toggleTheme()" class="w-10 h-10 rounded-full bg-white border-2 border-purple-400 flex items-center justify-center text-xl shadow-md">
                    <span id="theme-icon">‚ú®</span>
                </button>
                <button onclick="goHome()" class="w-10 h-10 rounded-full bg-white border-2 border-green-400 flex items-center justify-center text-xl shadow-md">
                    <span>üè†</span>
                </button>
            </div>
        </div>
        <div id="progress-container" class="hidden w-full max-w-5xl mx-auto mt-2">
            <div class="flex justify-between items-center mb-1">
                <span id="page-indicator" class="text-xs font-black text-purple-600">MISSION PROGRESS: 0%</span>
                <span class="text-xl">üöÄ</span>
            </div>
            <div class="h-4 bg-white rounded-full border-2 border-purple-200 overflow-hidden p-0.5">
                <div id="progress-bar" class="bg-gradient-to-r from-purple-400 to-pink-500 h-full rounded-full transition-all duration-700" style="width: 0%"></div>
            </div>
        </div>
    </header>

    <main class="flex-grow w-full max-w-5xl mx-auto px-4 py-8 mb-24">
        <div id="main-view"></div>
    </main>

    <footer id="quiz-footer" class="hidden fixed bottom-0 left-0 right-0 bg-yellow-100 border-t-4 border-yellow-300 py-4 px-6 z-40 shadow-[0_-10px_20px_rgba(0,0,0,0.05)]">
        <div class="max-w-xl mx-auto flex gap-4">
            <button onclick="handleBack()" id="prev-btn" class="flex-1 py-4 bg-white border-4 border-orange-400 text-orange-600 rounded-3xl font-black text-lg hover:bg-orange-50 transition-all active:scale-95 shadow-md">üîô OOPS, GO BACK</button>
            <button onclick="nextPage()" id="next-btn" class="flex-1 py-4 bg-green-500 border-4 border-green-700 text-white rounded-3xl font-black text-lg hover:bg-green-600 transition-all active:scale-95 shadow-md">KEEP GOING! üöÄ</button>
        </div>
    </footer>

    <div id="toast" class="fixed top-24 left-1/2 -translate-x-1/2 px-8 py-4 rounded-full text-white font-black shadow-2xl transition-all duration-300 opacity-0 pointer-events-none z-[60] text-xl border-4 border-white"></div>

    <script>
        // Content preserved EXACTLY as requested
        const COIN_URLS = {
            c1: "https://raw.githubusercontent.com/Waeil55/roma/main/1.PNG",
            c5: "https://raw.githubusercontent.com/Waeil55/roma/main/5.PNG",
            c10: "https://raw.githubusercontent.com/Waeil55/roma/main/10.PNG",
            c25: "https://raw.githubusercontent.com/Waeil55/roma/main/25.PNG",
            c100: "https://raw.githubusercontent.com/Waeil55/roma/main/1dollar.PNG"
        };

        const getCoin = (key) => {
            const sizes = { c10: '4.2em', c1: '4.45em', c5: '5.0em', c25: '5.7em', c100: '6.25em' };
            return `<img src="${COIN_URLS[key]}" class="coin-img" style="height: ${sizes[key]}" alt="${key}">`;
        };

        function getClockSVG(h, m) {
            const hDeg = (h % 12 + m / 60) * 30;
            const mDeg = m * 6;
            return `
            <svg class="clock-svg w-32 h-32 mx-auto" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="45" fill="#FFF" stroke="#FF6B6B" stroke-width="4"/>
                <circle cx="50" cy="50" r="2" fill="#FF6B6B"/>
                ${[12, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11].map((n, i) => {
                    const ang = (i * 30) * Math.PI / 180;
                    return `<text x="${50 + 35 * Math.sin(ang)}" y="${54 - 35 * Math.cos(ang)}" font-size="9" text-anchor="middle" fill="#FF6B6B" font-family="Comic Neue" font-weight="900">${n}</text>`;
                }).join('')}
                <line x1="50" y1="50" x2="50" y2="28" stroke="#2D3436" stroke-width="4" stroke-linecap="round" transform="rotate(${hDeg} 50 50)"/>
                <line x1="50" y1="50" x2="50" y2="18" stroke="#FF6B6B" stroke-width="3" stroke-linecap="round" transform="rotate(${mDeg} 50 50)"/>
            </svg>`;
        }

        function getShapeSVG(type) {
            const shapes = {
                circle: '<circle cx="50" cy="50" r="40" fill="#FF7675" stroke="#D63031" stroke-width="3"/>',
                square: '<rect x="15" y="15" width="70" height="70" fill="#74B9FF" stroke="#0984E3" stroke-width="3"/>',
                triangle: '<polygon points="50,15 90,85 10,85" fill="#55EFC4" stroke="#00B894" stroke-width="3"/>',
                rectangle: '<rect x="10" y="25" width="80" height="50" fill="#FDCB6E" stroke="#E17055" stroke-width="3"/>',
                star: '<polygon points="50,5 63,35 95,35 70,55 80,85 50,65 20,85 30,55 5,35 37,35" fill="#A29BFE" stroke="#6C5CE7" stroke-width="3"/>',
                sphere: '<circle cx="50" cy="50" r="40" fill="url(#sphereGrad)"/><defs><radialGradient id="sphereGrad" cx="30%" cy="30%" r="50%"><stop offset="0%" stop-color="#81ECEC"/><stop offset="100%" stop-color="#00CEC9"/></radialGradient></defs>',
                cube: '<path d="M20 30 l30 -10 l30 10 v40 l-30 10 l-30 -10 z" fill="#FAB1A0" stroke="#E17055" stroke-width="3"/><path d="M20 30 l30 10 l30 -10 M50 40 v40" fill="none" stroke="#E17055" stroke-width="3"/>',
                cone: '<ellipse cx="50" cy="80" rx="30" ry="10" fill="#FFEAA7" stroke="#FDCB6E" stroke-width="3"/><path d="M20 80 L50 20 L80 80" fill="#FFEAA7" stroke="#FDCB6E" stroke-width="3"/>',
                cylinder: '<ellipse cx="50" cy="25" rx="30" ry="10" fill="#81ECEC" stroke="#00CEC9" stroke-width="3"/><path d="M20 25 v50 a30 10 0 0 0 60 0 v-50" fill="#81ECEC" stroke="#00CEC9" stroke-width="3"/><ellipse cx="50" cy="75" rx="30" ry="10" fill="none" stroke="#00CEC9" stroke-width="3" stroke-dasharray="2 2"/>',
                pyramid: '<polygon points="50,15 85,85 15,85" fill="#D63031" stroke="#2D3436" stroke-width="3"/><line x1="50" y1="15" x2="50" y2="85" stroke="#2D3436" stroke-width="2"/>'
            };
            return `<svg class="shape-svg w-32 h-32 mx-auto" viewBox="0 0 100 100">${shapes[type] || ''}</svg>`;
        }

        // --- Content Blocks (Pasted Identically) ---
        const lessonData = [
            {
                title: "Page 1: Antonyms",
                instr: "Choose the word that means the opposite of the underlined word.",
                qs: [
                    { q: "1. a <u>problem</u>", opts: ["solution", "worry", "math", "sentence"], c: 0 },
                    { q: "2. was <u>loose</u>", opts: ["tight", "large", "big", "win"], c: 0 },
                    { q: "3. a <u>question</u>", opts: ["word", "poem", "answer", "talk"], c: 2 },
                    { q: "4. was <u>fact</u>", opts: ["true", "real", "scary", "fiction"], c: 3 },
                    { q: "5. was <u>straight</u>", opts: ["bent", "tall", "narrow", "long"], c: 0 },
                    { q: "6. to <u>create</u>", opts: ["make", "build", "destroy", "draw"], c: 2 },
                    { q: "7. was <u>shiny</u>", opts: ["dull", "bright", "pretty", "ugly"], c: 0 },
                    { q: "8. to <u>listen</u>", opts: ["hear", "ignore", "touch", "eat"], c: 1 }
                ]
            },
            {
                title: "Page 2: Homographs",
                instr: "Choose the word that correctly completes BOTH sentences.",
                qs: [
                    { q: "1. She counted all the ___ in her purse.<br>He will ___ clothes before practice.", opts: ["coins", "change", "buy", "money"], c: 1 },
                    { q: "2. I will ___ a movie before bed.<br>Use your ___ to tell the time.", opts: ["watch", "clock", "see", "rent"], c: 0 },
                    { q: "3. If it gets too hot, turn on the ___.<br>I am a big ___ of the basketball team.", opts: ["fan", "air", "player", "water"], c: 0 },
                    { q: "4. Don't forget to ___ your bag.<br>Buy a ___ of gum at the store.", opts: ["stick", "pack", "bring", "use"], c: 1 },
                    { q: "5. She ___ school every day at 3:00.<br>In the fall, rake the ___.", opts: ["grass", "leaves", "visits", "flowers"], c: 1 },
                    { q: "6. We took a ___ to the fair.<br>You can ___ your dog to do tricks.", opts: ["car", "teach", "train", "bus"], c: 2 },
                    { q: "7. Learn about ___ in science class.<br>Floss the ___ between your teeth.", opts: ["plants", "letter", "water", "space"], c: 3 },
                    { q: "8. Don't ___ in front of others.<br>___ the paper into four squares.", opts: ["tear", "rip", "cut", "hit"], c: 2 }
                ]
            },
            {
                title: "Page 3: Prefixes Mastery",
                instr: "Choose the correct word based on the prefix meaning.",
                qs: [
                    { q: "1. Which word means <b>not</b> fair?", opts: ["Fairness", "Unfair", "Missfair", "Disfair"], c: 1 },
                    { q: "2. Which word means to wind <b>again</b>?", opts: ["Rewind", "Rewinding", "Unwind", "Miswind"], c: 0 },
                    { q: "3. Which word means to heat <b>before</b>?", opts: ["Heating", "Preheat", "Unheat", "Misheat"], c: 1 },
                    { q: "4. Which word means to make <b>again</b>?", opts: ["Remake", "Remaking", "Unmake", "Dismake"], c: 0 },
                    { q: "5. Which word means to <b>stop appearing</b>?", opts: ["Appearing", "Disappear", "Misappear", "Reappear"], c: 1 },
                    { q: "6. Which word means to spell <b>wrong</b>?", opts: ["Spellings", "Misspell", "Unspell", "Prespell"], c: 1 },
                    { q: "7. Which word means to <b>not</b> agree?", opts: ["Agreements", "Disagree", "Unagree", "Misagree"], c: 1 },
                    { q: "8. Which word means <b>not</b> even?", opts: ["Evenly", "Uneven", "Reeven", "Diseven"], c: 1 }
                ]
            },
            {
                title: "Page 4: Suffixes Mastery",
                instr: "Choose the correct word based on the suffix meaning.",
                qs: [
                    { q: "1. Which word means <b>without</b> worth?", opts: ["Worthful", "Worthless", "Worthness", "Worthly"], c: 1 },
                    { q: "2. Which word means the <b>state</b> of being weak?", opts: ["Weakly", "Weakness", "Weakful", "Weakless"], c: 1 },
                    { q: "3. Which word means <b>full of</b> help?", opts: ["Helpless", "Helpful", "Helpness", "Helply"], c: 1 },
                    { q: "4. Which word means <b>one who</b> teaches?", opts: ["Teaching", "Teacher", "Teachless", "Teachful"], c: 1 },
                    { q: "5. Which word means <b>without</b> a home?", opts: ["Homely", "Homeless", "Homeness", "Homeful"], c: 1 },
                    { q: "6. Which word means <b>full of</b> color?", opts: ["Colorly", "Colorful", "Colorless", "Colorness"], c: 1 },
                    { q: "7. Which word means <b>in a quick way</b>?", opts: ["Quickless", "Quickly", "Quickful", "Quicker"], c: 1 },
                    { q: "8. Which word means <b>one who</b> leads?", opts: ["Leading", "Leader", "Leadless", "Leadful"], c: 1 }
                ]
            },
            {
                title: "Page 5: Phonics Auditory",
                instr: "Identify words with specific beginning or ending sounds.",
                qs: [
                    { q: "1. Same <b>beginning sound</b> as <u>duck</u>:", opts: ["drop", "door", "jump"], c: 1 },
                    { q: "2. Same <b>beginning sound</b> as <u>shoe</u>:", opts: ["slip", "shop", "school"], c: 1 },
                    { q: "3. Same <b>ending sound</b> as <u>bed</u>:", opts: ["ready", "door", "lead"], c: 2 },
                    { q: "4. Same <b>ending sound</b> as <u>back</u>:", opts: ["check", "lunch", "camp"], c: 0 }
                ]
            },
            {
                title: "Page 6: Phonics & Mixed Practice",
                instr: "Choose the best word based on sounds or context.",
                qs: [
                    { q: "5. Same middle sound as <b>chart</b>:", opts: ["past", "brain", "tray", "farm"], c: 3 },
                    { q: "6. Same middle sound as <b>feet</b>:", opts: ["met", "them", "treat", "there"], c: 2 },
                    { q: "7. Synonym of <u>fast</u>:", opts: ["slow", "race", "quick", "run"], c: 2 },
                    { q: "8. Antonym of <u>outside</u>:", opts: ["under", "playing", "next", "inside"], c: 3 },
                    { q: "9. Please ___ papers / never been to that ___.", opts: ["put", "place", "school", "lay"], c: 1 },
                    { q: "10. turn ___ / answers ___ on test.", opts: ["left", "correct", "right", "around"], c: 2 }
                ]
            },
            {
                title: "Pages 7-8: Section 2 - Penguins",
                passage: "Most penguins live in a land of snow and ice. They have feathers, wings, and a beak... But they cannot fly because their body is too heavy. They use their flat, stiff wings as flippers to help them swim swiftly. They eat shrimplike animals called krill.",
                qs: [
                    { q: "1. Which sentence DOES NOT tell how they move?", opts: ["waddle land", "slide on bellies", "make nest of pebbles", "webbed feet"], c: 2 },
                    { q: "2. Meaning of <b>swiftly</b>:", opts: ["carefully", "quickly", "slowly", "safely"], c: 1 },
                    { q: "3. <b>Krill</b> means:", opts: ["eggs", "fish", "shrimplike animals", "babies"], c: 2 },
                    { q: "4. Fact about penguins:", opts: ["bad swimmers", "exactly like other birds", "wings help swim", "only mothers"], c: 2 }
                ]
            },
            {
                title: "Pages 9-10: Wright Brothers",
                passage: "Orville and Wilbur Wright owned a bicycle shop. In 1899, they began to experiment with flight using kites and gliders. In 1903, they took the first motor-powered flight for 12 seconds.",
                qs: [
                    { q: "8. Main idea:", opts: ["Testing bad", "Flyer first", "Early pilots", "Bike shop"], c: 2 },
                    { q: "9. <b>Experiment</b>:", opts: ["try new ideas", "test kites", "stay in air", "fly airplane"], c: 0 },
                    { q: "12. Opposite of started:", opts: ["began", "finished", "first", "continued"], c: 1 },
                    { q: "13. Opinion:", opts: ["Tested kites", "Flight in 1903", "Very smart", "Flyer first"], c: 2 }
                ]
            },
            {
                title: "Pages 11-12: Section 3 - My Shadow",
                passage: "I have a little shadow that goes in and out with me. He is very like me from the heels up to the head... The funniest thing about him is the way he likes to grow.",
                qs: [
                    { q: "1. Poem focus:", opts: ["school", "animals", "shadow relationship", "lost"], c: 2 },
                    { q: "2. Feeling:", opts: ["afraid", "bored", "amused", "quiet"], c: 2 },
                    { q: "3. Difference:", opts: ["grow/shrink", "jump", "find dew", "play"], c: 0 }
                ]
            },
            {
                title: "Pages 13-14: Uncle Wilber",
                passage: "Uncle Wilber is strange. He sent Oscar the goldfish. Friday Wilber came to take Oscar home. He left a heavy box that hisses and says 'Be Careful'.",
                qs: [
                    { q: "8. What happened Friday?", opts: ["got fish", "got letter", "picked up Oscar", "vacation"], c: 2 },
                    { q: "10. Describe Wilber:", opts: ["weird", "rude", "greedy", "selfish"], c: 0 }
                ]
            },
            {
                title: "Page 16: Synonyms Mastery",
                instr: "Choose the word that means about the same.",
                qs: [
                    { q: "1. was <u>old</u>", opts: ["new", "ancient", "young", "dirty"], c: 1 },
                    { q: "2. was <u>quiet</u>", opts: ["loud", "silent", "noisy", "yelling"], c: 1 },
                    { q: "3. was <u>thin</u>", opts: ["narrow", "wide", "short", "tall"], c: 0 },
                    { q: "4. was <u>unusual</u>", opts: ["regular", "normal", "strange", "same"], c: 2 },
                    { q: "5. was <u>shiny</u>", opts: ["bright", "dull", "new", "pretty"], c: 0 }
                ]
            },
            {
                title: "Page 17: Context Clues Mastery",
                instr: "Read the context and fill in the numbered blanks.",
                passage: "My family is going on a (1) trip. We will (2) to the beach in our car. Some people like to (3) soda and eat candy. You should (4) brush your teeth. We are going to learn (6) animals. I do not have (7) time to finish my book.",
                qs: [
                    { q: "1. Blank (1):", opts: ["large", "clean", "special", "hard"], c: 2 },
                    { q: "2. Blank (2):", opts: ["swim", "travel", "together", "bring"], c: 1 },
                    { q: "3. Blank (3):", opts: ["drink", "carry", "start", "bring"], c: 0 }
                ]
            }
        ];

        const initialCoinData = [
            { q: `${getCoin('c1')} + ${getCoin('c1')} + ${getCoin('c1')}`, opts: ["2 cents", "3 cents", "5 cents", "10 cents"], c: 1 },
            { q: `${getCoin('c5')} + ${getCoin('c5')}`, opts: ["5 cents", "10 cents", "25 cents", "2 cents"], c: 1 },
            { q: `${getCoin('c10')} + ${getCoin('c10')}`, opts: ["10 cents", "20 cents", "25 cents", "15 cents"], c: 1 },
            { q: `${getCoin('c25')} + ${getCoin('c10')}`, opts: ["30 cents", "35 cents", "40 cents", "25 cents"], c: 1 },
            { q: `${getCoin('c100')} - ${getCoin('c25')}`, opts: ["75 cents", "50 cents", "25 cents", "100 cents"], c: 0 },
            { q: `${getCoin('c25')} + ${getCoin('c25')} + ${getCoin('c25')} + ${getCoin('c25')}`, opts: ["50 cents", "75 cents", "$1.00", "$2.00"], c: 2 },
            { q: `${getCoin('c10')} + ${getCoin('c5')} + ${getCoin('c1')}`, opts: ["15 cents", "16 cents", "20 cents", "11 cents"], c: 1 },
            { q: `${getCoin('c100')} + ${getCoin('c100')} + ${getCoin('c25')}`, opts: ["$1.25", "$2.25", "$3.00", "$2.50"], c: 1 },
            { q: `${getCoin('c100')} + ${getCoin('c100')} + ${getCoin('c100')}`, opts: ["$1.00", "$2.00", "$3.00", "$4.00"], c: 2 },
            { q: `${getCoin('c100')} + ${getCoin('c10')} + ${getCoin('c10')} + ${getCoin('c5')}`, opts: ["$1.20", "$1.25", "$1.30", "$1.15"], c: 1 },
            { q: `${getCoin('c100')} + ${getCoin('c100')} + ${getCoin('c5')} + ${getCoin('c1')}`, opts: ["$2.05", "$2.10", "$2.06", "$2.15"], c: 2 },
            { q: `${getCoin('c100')} - ${getCoin('c10')} - ${getCoin('c10')}`, opts: ["90 cents", "80 cents", "70 cents", "100 cents"], c: 1 },
            { q: `${getCoin('c100')} + ${getCoin('c100')} + ${getCoin('c25')} + ${getCoin('c10')} + ${getCoin('c5')}`, opts: ["$2.40", "$2.50", "$2.35", "$2.45"], c: 0 },
            { q: `${getCoin('c100')} + ${getCoin('c100')} + ${getCoin('c100')} + ${getCoin('c100')}`, opts: ["$3.00", "$4.00", "$5.00", "$2.00"], c: 1 },
            { q: `${getCoin('c25')} + ${getCoin('c25')} + ${getCoin('c25')}`, opts: ["50 cents", "75 cents", "$1.00", "25 cents"], c: 1 },
            { q: `${getCoin('c10')} + ${getCoin('c10')} + ${getCoin('c10')} + ${getCoin('c10')}`, opts: ["30 cents", "40 cents", "50 cents", "20 cents"], c: 1 },
            { q: `${getCoin('c100')} + ${getCoin('c25')} + ${getCoin('c1')}`, opts: ["$1.25", "$1.26", "$1.30", "$1.01"], c: 1 }
        ];

        // --- Logic (Identical) ---
        function generateTimeData() {
            const times = [];
            for (let i = 0; i < 100; i++) {
                const h = Math.floor(Math.random() * 12) + 1;
                const m = Math.floor(Math.random() * 12) * 5;
                const correctStr = `${h}:${m.toString().padStart(2, '0')}`;
                const opts = new Set([correctStr]);
                while (opts.size < 4) {
                    const dh = Math.floor(Math.random() * 12) + 1;
                    const dm = Math.floor(Math.random() * 12) * 5;
                    opts.add(`${dh}:${dm.toString().padStart(2, '0')}`);
                }
                const sortedOpts = Array.from(opts).sort();
                times.push({ q: `What time is it now?<br>${getClockSVG(h, m)}`, opts: sortedOpts, c: sortedOpts.indexOf(correctStr) });
            }
            return times;
        }

        function generateMathData() {
            const math = [];
            for (let i = 0; i < 150; i++) {
                const op = Math.random() > 0.5 ? '+' : '-';
                let a, b, res;
                if (op === '+') { a = Math.floor(Math.random() * 101); b = Math.floor(Math.random() * (101 - a)); res = a + b; }
                else { a = Math.floor(Math.random() * 101); b = Math.floor(Math.random() * (a + 1)); res = a - b; }
                const correct = res.toString();
                const opts = new Set([correct]);
                while (opts.size < 4) opts.add((res + Math.floor(Math.random() * 20) - 10).toString());
                const sortedOpts = Array.from(opts).sort((x, y) => parseInt(x) - parseInt(y));
                math.push({ q: `Calculate: ${a} ${op} ${b} = ?`, opts: sortedOpts, c: sortedOpts.indexOf(correct) });
            }
            return math;
        }

        function generateShapesData() {
            const list = [];
            const names = ["circle", "square", "triangle", "rectangle", "star", "sphere", "cube", "cone", "cylinder", "pyramid"];
            for (let i = 0; i < 120; i++) {
                const type = names[Math.floor(Math.random() * names.length)];
                const correct = type.charAt(0).toUpperCase() + type.slice(1);
                list.push({
                    q: `What shape is this?<br>${getShapeSVG(type)}`,
                    opts: ["Circle", "Square", "Triangle", "Rectangle", "Star", "Sphere", "Cube", "Cone", "Cylinder", "Pyramid"].sort(),
                    c: ["Circle", "Square", "Triangle", "Rectangle", "Star", "Sphere", "Cube", "Cone", "Cylinder", "Pyramid"].sort().indexOf(correct)
                });
            }
            return list;
        }

        function generateGrammarData() {
            const nouns = ["Dog", "Apple", "Teacher", "School", "Book", "Park", "Cat", "Ball", "Table", "Chair", "Car", "Tree"];
            const verbs = ["Run", "Jump", "Eat", "Sleep", "Sing", "Dance", "Write", "Read", "Swim", "Play", "Laugh", "Walk"];
            const list = [];
            for (let i = 0; i < 120; i++) {
                const isNoun = Math.random() > 0.5;
                const word = isNoun ? nouns[Math.floor(Math.random() * nouns.length)] : verbs[Math.floor(Math.random() * verbs.length)];
                list.push({
                    q: `Is the word "<b>${word}</b>" a Noun or a Verb?`,
                    opts: ["Noun", "Verb"],
                    c: isNoun ? 0 : 1
                });
            }
            return list;
        }

        let currentView = 'home'; 
        let activeData = [];
        let currentPage = 0;
        let userAnswers = {};
        let fontSize = 22;
        let isDarkMode = false;

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark', isDarkMode);
            document.getElementById('theme-icon').innerText = isDarkMode ? '‚òÄÔ∏è' : '‚ú®';
        }

        function goHome() {
            currentView = 'home';
            render();
            window.scrollTo(0, 0);
        }

        function adjustFont(val) {
            fontSize = Math.max(16, Math.min(48, fontSize + val));
            document.documentElement.style.setProperty('--user-font-size', `${fontSize}px`);
        }

        function startSection(type) {
            let baseData = [];
            let perPage = 5;
            if (type === 'lesson') { activeData = lessonData; }
            else if (type === 'coin') { baseData = shuffle([...initialCoinData]); perPage = 2; }
            else if (type === 'time') { baseData = shuffle(generateTimeData()); perPage = 8; }
            else if (type === 'math') { baseData = shuffle(generateMathData()); perPage = 10; }
            else if (type === 'shapes') { baseData = shuffle(generateShapesData()); perPage = 5; }
            else if (type === 'grammar') { baseData = shuffle(generateGrammarData()); perPage = 10; }

            if (type !== 'lesson') {
                activeData = [];
                for (let i = 0; i < baseData.length; i += perPage) {
                    activeData.push({ 
                        title: `The ${type.toUpperCase()} Quest - Map ${activeData.length + 1}`, 
                        instr: "Solve these puzzles to win stickers! üèÜ", 
                        qs: baseData.slice(i, i + perPage) 
                    });
                }
            }
            currentPage = 0;
            userAnswers = {};
            currentView = 'quiz';
            render();
            window.scrollTo(0, 0);
        }

        function handleBack() {
            if (currentPage > 0) { currentPage--; render(); window.scrollTo(0, 0); }
            else goHome();
        }

        function nextPage() {
            if (currentPage < activeData.length - 1) { currentPage++; render(); window.scrollTo(0, 0); }
            else finish();
        }

        function render() {
            const main = document.getElementById('main-view');
            const footer = document.getElementById('quiz-footer');
            const progress = document.getElementById('progress-container');

            if (currentView === 'home') {
                footer.classList.add('hidden');
                progress.classList.add('hidden');
                main.innerHTML = `
                    <div class="text-center py-6">
                        <div class="inline-block bg-white p-4 rounded-3xl border-4 border-orange-400 rotate-2 mb-8 shadow-lg">
                             <h2 class="text-3xl lg:text-5xl font-black text-orange-500">PICK YOUR ADVENTURE! üè∞</h2>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                            <div onclick="startSection('lesson')" class="hub-card lesson-gradient p-8 text-white shadow-xl cursor-pointer">
                                <div class="text-6xl mb-4">üìñ</div>
                                <h3 class="text-3xl font-black mb-1">Lesson Mastery</h3>
                                <p class="font-bold opacity-80">Full PDF Review</p>
                            </div>
                            <div onclick="startSection('coin')" class="hub-card coin-gradient p-8 text-white shadow-xl cursor-pointer">
                                <div class="text-6xl mb-4">üí∞</div>
                                <h3 class="text-3xl font-black mb-1">Coin Math Lab</h3>
                                <p class="font-bold opacity-80">Money Counting</p>
                            </div>
                            <div onclick="startSection('time')" class="hub-card time-gradient p-8 text-white shadow-xl cursor-pointer">
                                <div class="text-6xl mb-4">‚è∞</div>
                                <h3 class="text-3xl font-black mb-1">Time Lab</h3>
                                <p class="font-bold opacity-80">Read the Clock</p>
                            </div>
                            <div onclick="startSection('math')" class="hub-card math-gradient p-8 text-white shadow-xl cursor-pointer">
                                <div class="text-6xl mb-4">‚ûï</div>
                                <h3 class="text-3xl font-black mb-1">Math Lab</h3>
                                <p class="font-bold opacity-80">150+ Problems</p>
                            </div>
                            <div onclick="startSection('shapes')" class="hub-card shapes-gradient p-8 text-white shadow-xl cursor-pointer">
                                <div class="text-6xl mb-4">üìê</div>
                                <h3 class="text-3xl font-black mb-1">Shapes Lab</h3>
                                <p class="font-bold opacity-80">2D & 3D Geometry</p>
                            </div>
                            <div onclick="startSection('grammar')" class="hub-card grammar-gradient p-8 text-white shadow-xl cursor-pointer">
                                <div class="text-6xl mb-4">üñçÔ∏è</div>
                                <h3 class="text-3xl font-black mb-1">Grammar Lab</h3>
                                <p class="font-bold opacity-80">Noun vs Verb</p>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentView === 'quiz') {
                footer.classList.remove('hidden');
                progress.classList.remove('hidden');
                const data = activeData[currentPage];
                const progVal = ((currentPage + 1) / activeData.length) * 100;
                document.getElementById('page-indicator').innerText = `QUEST PROGRESS: ${Math.round(progVal)}%`;
                document.getElementById('progress-bar').style.width = `${progVal}%`;

                let passageHtml = data.passage ? `
                    <div class="sticky-passage">
                        <div class="passage-box p-8 mb-6 shadow-xl bg-white">
                            <p class="font-bold font-dynamic text-blue-900 leading-loose">${data.passage}</p>
                        </div>
                        <div class="text-center mb-4"><span class="text-4xl">üïµÔ∏è‚Äç‚ôÇÔ∏è</span></div>
                    </div>` : '';

                let questionsHtml = '';
                data.qs.forEach((q, qIdx) => {
                    const key = `${currentPage}-${qIdx}`;
                    const answered = userAnswers[key] !== undefined;
                    questionsHtml += `
                        <div class="card p-8 mb-8 bg-white overflow-hidden relative">
                            <div class="absolute -top-2 -right-2 text-4xl opacity-10">ü§î</div>
                            <div class="font-black mb-6 q-text text-2xl text-purple-700">${q.q}</div>
                            <div class="grid grid-cols-1 ${q.opts.length > 2 ? 'sm:grid-cols-2' : ''} gap-4">
                                ${q.opts.map((opt, oIdx) => {
                                    let cls = answered ? (oIdx === q.c ? "correct" : (oIdx === userAnswers[key] ? "wrong" : "opacity-30")) : "";
                                    let icon = answered ? (oIdx === q.c ? "‚úÖ" : (oIdx === userAnswers[key] ? "‚ùå" : "")) : "";
                                    return `<button onclick="handleAnswer(${qIdx}, ${oIdx})" ${answered ? 'disabled' : ''} class="option-btn w-full p-4 text-left font-black transition-all flex justify-between items-center ${cls}">
                                        <span>${opt}</span>
                                        <span>${icon}</span>
                                    </button>`;
                                }).join('')}
                            </div>
                        </div>`;
                });

                main.innerHTML = `
                    <div class="mb-10 text-center">
                        <h2 class="font-black text-4xl mb-2 text-purple-600">${data.title}</h2>
                        <div class="inline-block bg-yellow-200 px-4 py-1 rounded-full border-2 border-yellow-400 font-bold text-yellow-700">
                             üí° ${data.instr || 'Read carefully, little genius!'}
                        </div>
                    </div>
                    <div class="${data.passage ? 'lg:grid lg:grid-cols-2 lg:gap-12' : 'max-w-3xl mx-auto'}">
                        ${passageHtml}
                        <div class="space-y-4">
                            ${questionsHtml}
                        </div>
                    </div>
                `;
            }
        }

        window.handleAnswer = (qIdx, oIdx) => {
            userAnswers[`${currentPage}-${qIdx}`] = oIdx;
            const isCorrect = oIdx === activeData[currentPage].qs[qIdx].c;
            const toast = document.getElementById('toast');
            
            const coolMessages = isCorrect ? 
                ["BOOM! CORRECT! üí•", "YOU'RE A WIZARD! üßô‚Äç‚ôÇÔ∏è", "SUPER GENIUS! üß†", "YAY! HOORAY! üéâ"] : 
                ["OOPSIE! üçå", "NOT QUITE! üßê", "TRY AGAIN, HERO! ü¶∏‚Äç‚ôÇÔ∏è", "OH NO! üôà"];
            
            toast.innerText = coolMessages[Math.floor(Math.random()*coolMessages.length)];
            toast.style.backgroundColor = isCorrect ? "#00B894" : "#D63031";
            toast.style.opacity = "1";
            toast.style.transform = "translateX(-50%) translateY(-20px) scale(1.2)";
            
            setTimeout(() => {
                toast.style.opacity = "0";
                toast.style.transform = "translateX(-50%) translateY(0) scale(1)";
            }, 1200);
            render();
        };

        function finish() {
            currentView = 'results';
            document.getElementById('quiz-footer').classList.add('hidden');
            document.getElementById('progress-container').classList.add('hidden');
            let total = 0, correct = 0;
            activeData.forEach((p, pi) => p.qs.forEach((q, qi) => { total++; if (userAnswers[`${pi}-${qi}`] === q.c) correct++; }));
            const scorePercent = Math.round((correct/total)*100);
            
            let resultStuff = scorePercent >= 90 ? 
                { emoji: "üëë", msg: "YOU ARE THE KING/QUEEN!", sub: "Unbelievable skills!", color: "text-yellow-500" } : 
                (scorePercent >= 70 ? 
                    { emoji: "üåü", msg: "SUPERSTAR STATUS!", sub: "You're doing amazing!", color: "text-blue-500" } : 
                    { emoji: "üöÄ", msg: "KEEP TRAINING, PILOT!", sub: "You're getting better every day!", color: "text-green-500" }
                );

            document.getElementById('main-view').innerHTML = `
                <div class="max-w-3xl mx-auto text-center py-12 px-8 bg-white rounded-[4rem] shadow-2xl mt-8 border-8 border-orange-200">
                    <div class="text-9xl mb-8 animate-bounce">${resultStuff.emoji}</div>
                    <h2 class="text-5xl font-black mb-4 ${resultStuff.color}">${resultStuff.msg}</h2>
                    <p class="text-slate-500 font-black text-2xl mb-10">${resultStuff.sub}</p>
                    
                    <div class="relative inline-block mb-12">
                        <div class="text-8xl font-black text-purple-600">${scorePercent}%</div>
                        <div class="absolute -top-4 -right-8 text-4xl rotate-12">üèÜ</div>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <button onclick="goHome()" class="py-6 bg-orange-500 border-b-8 border-orange-700 hover:bg-orange-400 text-white rounded-[2.5rem] font-black text-2xl transition-all active:translate-y-2 active:border-b-0 shadow-lg">PLAY AGAIN! üéÆ</button>
                        <button onclick="location.reload()" class="py-6 bg-purple-500 border-b-8 border-purple-700 hover:bg-purple-400 text-white rounded-[2.5rem] font-black text-2xl transition-all active:translate-y-2 active:border-b-0 shadow-lg">NEW QUEST! üó∫Ô∏è</button>
                    </div>
                    
                    <div class="mt-8 text-6xl">üéà üéä ü¶Ñ ü•≥ üç≠</div>
                </div>`;
            window.scrollTo(0, 0);
        }
        render();
    </script>
</body>
</html>

